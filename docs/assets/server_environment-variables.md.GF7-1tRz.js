import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.-kPtTt-D.js";const c=JSON.parse('{"title":"Environment Variables Reference","description":"","frontmatter":{},"headers":[],"relativePath":"server/environment-variables.md","filePath":"server/environment-variables.md"}'),e={name:"server/environment-variables.md"};function l(p,s,r,d,h,o){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="environment-variables-reference" tabindex="-1">Environment Variables Reference <a class="header-anchor" href="#environment-variables-reference" aria-label="Permalink to &quot;Environment Variables Reference&quot;">​</a></h1><p>Complete configuration reference for Queen MQ server. These variables control all aspects of server behavior.</p><h2 id="quick-reference" tabindex="-1">Quick Reference <a class="header-anchor" href="#quick-reference" aria-label="Permalink to &quot;Quick Reference&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>PORT</code></td><td>6632</td><td>HTTP server port</td></tr><tr><td><code>NUM_WORKERS</code></td><td>10</td><td>Worker threads (max: CPU cores)</td></tr><tr><td><code>DB_POOL_SIZE</code></td><td>150</td><td><strong>CRITICAL</strong> - Connection pool size</td></tr><tr><td><code>PG_HOST</code></td><td>localhost</td><td>PostgreSQL host</td></tr><tr><td><code>LOG_LEVEL</code></td><td>info</td><td>Log level (debug, info, warn, error)</td></tr></tbody></table><h2 id="server-configuration" tabindex="-1">Server Configuration <a class="header-anchor" href="#server-configuration" aria-label="Permalink to &quot;Server Configuration&quot;">​</a></h2><h3 id="basic-settings" tabindex="-1">Basic Settings <a class="header-anchor" href="#basic-settings" aria-label="Permalink to &quot;Basic Settings&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>PORT</code></td><td>int</td><td>6632</td><td>HTTP server port</td></tr><tr><td><code>HOST</code></td><td>string</td><td>0.0.0.0</td><td>HTTP server host</td></tr><tr><td><code>WORKER_ID</code></td><td>string</td><td>cpp-worker-1</td><td>Unique identifier for this worker</td></tr><tr><td><code>APP_NAME</code></td><td>string</td><td>queen-mq</td><td>Application name</td></tr><tr><td><code>NUM_WORKERS</code></td><td>int</td><td>10</td><td>Number of worker threads (capped at CPU core count)</td></tr><tr><td><code>WEBAPP_ROOT</code></td><td>string</td><td>auto-detect</td><td>Path to webapp/dist directory for dashboard</td></tr></tbody></table><p><strong>Example:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6632</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./bin/queen-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="database-configuration" tabindex="-1">Database Configuration <a class="header-anchor" href="#database-configuration" aria-label="Permalink to &quot;Database Configuration&quot;">​</a></h2><h3 id="connection-settings" tabindex="-1">Connection Settings <a class="header-anchor" href="#connection-settings" aria-label="Permalink to &quot;Connection Settings&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>PG_USER</code></td><td>string</td><td>postgres</td><td>PostgreSQL username</td></tr><tr><td><code>PG_HOST</code></td><td>string</td><td>localhost</td><td>PostgreSQL host</td></tr><tr><td><code>PG_DB</code></td><td>string</td><td>postgres</td><td>PostgreSQL database name</td></tr><tr><td><code>PG_PASSWORD</code></td><td>string</td><td>postgres</td><td>PostgreSQL password</td></tr><tr><td><code>PG_PORT</code></td><td>string</td><td>5432</td><td>PostgreSQL port</td></tr></tbody></table><h3 id="ssl-configuration" tabindex="-1">SSL Configuration <a class="header-anchor" href="#ssl-configuration" aria-label="Permalink to &quot;SSL Configuration&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>PG_USE_SSL</code></td><td>bool</td><td>false</td><td>Enable SSL connection</td></tr><tr><td><code>PG_SSL_REJECT_UNAUTHORIZED</code></td><td>bool</td><td>true</td><td>Reject unauthorized SSL certificates</td></tr></tbody></table><p><strong>SSL Mode Mapping:</strong></p><ul><li><code>PG_USE_SSL=true</code> + <code>PG_SSL_REJECT_UNAUTHORIZED=true</code> → <code>sslmode=require</code></li><li><code>PG_USE_SSL=true</code> + <code>PG_SSL_REJECT_UNAUTHORIZED=false</code> → <code>sslmode=prefer</code></li><li><code>PG_USE_SSL=false</code> → <code>sslmode=disable</code></li></ul><p><strong>Example for Production (Cloud SQL, RDS, Azure):</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your-db.cloud.provider.com</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5432</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secure_password</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_DB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USE_SSL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_SSL_REJECT_UNAUTHORIZED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="pool-configuration" tabindex="-1">Pool Configuration <a class="header-anchor" href="#pool-configuration" aria-label="Permalink to &quot;Pool Configuration&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DB_POOL_SIZE</code></td><td>int</td><td>150</td><td><strong>CRITICAL</strong> - Total connection pool size</td></tr><tr><td><code>DB_IDLE_TIMEOUT</code></td><td>int</td><td>30000</td><td>Idle timeout in milliseconds</td></tr><tr><td><code>DB_CONNECTION_TIMEOUT</code></td><td>int</td><td>2000</td><td>Connection timeout in milliseconds</td></tr><tr><td><code>DB_POOL_ACQUISITION_TIMEOUT</code></td><td>int</td><td>10000</td><td>Pool acquisition timeout (wait for available connection)</td></tr><tr><td><code>DB_STATEMENT_TIMEOUT</code></td><td>int</td><td>30000</td><td>Statement timeout in milliseconds</td></tr><tr><td><code>DB_QUERY_TIMEOUT</code></td><td>int</td><td>30000</td><td>Query timeout in milliseconds</td></tr><tr><td><code>DB_LOCK_TIMEOUT</code></td><td>int</td><td>10000</td><td>Lock timeout in milliseconds</td></tr><tr><td><code>DB_MAX_RETRIES</code></td><td>int</td><td>3</td><td>Maximum connection retry attempts</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">CRITICAL: DB_POOL_SIZE</p><p>This is the <strong>most important tuning parameter</strong>. The pool is split:</p><ul><li><strong>AsyncDbPool</strong>: 95% (142 connections at default) - for PUSH/POP/ACK/TRANSACTION</li><li><strong>Background Pool</strong>: 5% (8 connections at default) - for metrics, retention, eviction</li></ul><p>Scale with workers: <code>DB_POOL_SIZE = NUM_WORKERS × 15</code> is a good starting point.</p></div><p><strong>Example Configurations:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Light load</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Medium load (default)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High load</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Very high load</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="queue-processing" tabindex="-1">Queue Processing <a class="header-anchor" href="#queue-processing" aria-label="Permalink to &quot;Queue Processing&quot;">​</a></h2><h3 id="pop-operation-defaults" tabindex="-1">Pop Operation Defaults <a class="header-anchor" href="#pop-operation-defaults" aria-label="Permalink to &quot;Pop Operation Defaults&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_TIMEOUT</code></td><td>int</td><td>30000</td><td>Default timeout for pop operations (ms)</td></tr><tr><td><code>MAX_TIMEOUT</code></td><td>int</td><td>60000</td><td>Maximum allowed timeout (ms)</td></tr><tr><td><code>DEFAULT_BATCH_SIZE</code></td><td>int</td><td>1</td><td>Default batch size for pop operations</td></tr><tr><td><code>BATCH_INSERT_SIZE</code></td><td>int</td><td>1000</td><td>Batch size for bulk inserts</td></tr></tbody></table><h3 id="long-polling-configuration" tabindex="-1">Long Polling Configuration <a class="header-anchor" href="#long-polling-configuration" aria-label="Permalink to &quot;Long Polling Configuration&quot;">​</a></h3><p>The system uses managed ThreadPools for all long-polling operations to ensure proper resource management and visibility.</p><h4 id="worker-configuration" tabindex="-1">Worker Configuration <a class="header-anchor" href="#worker-configuration" aria-label="Permalink to &quot;Worker Configuration&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>POLL_WORKER_COUNT</code></td><td>int</td><td>2</td><td>Number of dedicated poll worker threads (reserved in DB ThreadPool)</td></tr><tr><td><code>STREAM_POLL_WORKER_COUNT</code></td><td>int</td><td>2</td><td>Number of dedicated stream poll worker threads (reserved in DB ThreadPool)</td></tr><tr><td><code>STREAM_CONCURRENT_CHECKS</code></td><td>int</td><td>10</td><td>Maximum concurrent window check jobs per stream worker</td></tr><tr><td><code>DB_THREAD_POOL_SERVICE_THREADS</code></td><td>int</td><td>5</td><td>Threads for background service DB operations</td></tr></tbody></table><p><strong>ThreadPool Architecture:</strong></p><p>All worker threads run in the <strong>DB ThreadPool</strong> with the following allocation:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DB ThreadPool Size = P + S + (S × C) + T</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Where:</span></span>
<span class="line"><span>  P = POLL_WORKER_COUNT (regular poll workers)</span></span>
<span class="line"><span>  S = STREAM_POLL_WORKER_COUNT (stream poll workers)</span></span>
<span class="line"><span>  C = STREAM_CONCURRENT_CHECKS (concurrent checks per stream worker)</span></span>
<span class="line"><span>  T = DB_THREAD_POOL_SERVICE_THREADS (service DB operations)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Default: 2 + 2 + (2 × 10) + 5 = 29 threads</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Scaling Guidelines:</strong></p><ul><li>Low load (&lt; 20 clients): 2-5 poll workers, 2 stream workers</li><li>Medium load (20-100 clients): 5-10 poll workers, 4 stream workers</li><li>High load (100-200 clients): 10-20 poll workers, 8 stream workers</li><li>Very high load (200+ clients): 20-50 poll workers, 12 stream workers</li></ul><p>Each poll worker can efficiently handle ~5-10 active consumer groups.</p><h4 id="polling-intervals" tabindex="-1">Polling Intervals <a class="header-anchor" href="#polling-intervals" aria-label="Permalink to &quot;Polling Intervals&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>POLL_WORKER_INTERVAL</code></td><td>int</td><td>50</td><td>How often workers check for new client requests (ms) - in-memory operation</td></tr><tr><td><code>POLL_DB_INTERVAL</code></td><td>int</td><td>100</td><td>Initial DB query interval (ms) - aggressive first attempt</td></tr><tr><td><code>STREAM_POLL_WORKER_INTERVAL</code></td><td>int</td><td>100</td><td>How often stream workers check registry (ms)</td></tr><tr><td><code>STREAM_POLL_INTERVAL</code></td><td>int</td><td>1000</td><td>Min time between stream checks per group (ms)</td></tr></tbody></table><p><strong>How it works:</strong></p><ol><li>Workers check registry every 50ms (cheap in-memory check)</li><li>First DB query at 100ms (aggressive)</li><li>If no messages, exponential backoff kicks in</li></ol><h4 id="adaptive-exponential-backoff" tabindex="-1">Adaptive Exponential Backoff <a class="header-anchor" href="#adaptive-exponential-backoff" aria-label="Permalink to &quot;Adaptive Exponential Backoff&quot;">​</a></h4><p>When queues are consistently empty, the system automatically backs off to reduce DB load:</p><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>QUEUE_BACKOFF_THRESHOLD</code></td><td>int</td><td>1</td><td>Consecutive empty pops before backoff (1 = immediate)</td></tr><tr><td><code>QUEUE_BACKOFF_MULTIPLIER</code></td><td>double</td><td>2.0</td><td>Exponential backoff multiplier</td></tr><tr><td><code>QUEUE_MAX_POLL_INTERVAL</code></td><td>int</td><td>2000</td><td>Maximum poll interval after backoff (ms)</td></tr><tr><td><code>QUEUE_BACKOFF_CLEANUP_THRESHOLD</code></td><td>int</td><td>3600</td><td>Cleanup inactive backoff state entries after N seconds</td></tr></tbody></table><p><strong>Stream Backoff Configuration (separate from regular poll workers):</strong></p><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>STREAM_BACKOFF_THRESHOLD</code></td><td>int</td><td>5</td><td>Stream: Consecutive empty checks before backoff</td></tr><tr><td><code>STREAM_BACKOFF_MULTIPLIER</code></td><td>double</td><td>2.0</td><td>Stream: Exponential backoff multiplier</td></tr><tr><td><code>STREAM_MAX_POLL_INTERVAL</code></td><td>int</td><td>5000</td><td>Stream: Maximum poll interval after backoff (ms)</td></tr></tbody></table><p><strong>Example backoff sequence (regular poll workers, defaults):</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Query 1: 100ms  (aggressive first attempt)</span></span>
<span class="line"><span>Empty 1: 200ms  (backoff starts)</span></span>
<span class="line"><span>Empty 2: 400ms</span></span>
<span class="line"><span>Empty 3: 800ms</span></span>
<span class="line"><span>Empty 4: 1600ms</span></span>
<span class="line"><span>Empty 5+: 2000ms (capped)</span></span>
<span class="line"><span>Messages arrive: Reset to 100ms immediately</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Configuration Examples:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Low latency (higher CPU usage)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Balanced (default)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Conservative (lower CPU, higher latency)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="partition-selection" tabindex="-1">Partition Selection <a class="header-anchor" href="#partition-selection" aria-label="Permalink to &quot;Partition Selection&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>MAX_PARTITION_CANDIDATES</code></td><td>int</td><td>100</td><td>Candidate partitions for lease acquisition</td></tr></tbody></table><p><strong>Tuning:</strong></p><ul><li>Low partition count (&lt;50): Keep at 100</li><li>High partition count (&gt;200): Increase to 200-500</li><li>Very high (&gt;1000): Increase to 1000</li></ul><h3 id="batch-push-size-based-dynamic-batching" tabindex="-1">Batch Push - Size-Based Dynamic Batching <a class="header-anchor" href="#batch-push-size-based-dynamic-batching" aria-label="Permalink to &quot;Batch Push - Size-Based Dynamic Batching&quot;">​</a></h3><p>Queen uses intelligent size-based batching that dynamically calculates row sizes and optimizes for PostgreSQL performance.</p><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>BATCH_PUSH_USE_SIZE_BASED</code></td><td>bool</td><td>true</td><td>Enable size-based dynamic batching</td></tr><tr><td><code>BATCH_PUSH_TARGET_SIZE_MB</code></td><td>int</td><td>4</td><td>Target batch size in MB (sweet spot: 4-6 MB)</td></tr><tr><td><code>BATCH_PUSH_MIN_SIZE_MB</code></td><td>int</td><td>2</td><td>Minimum batch size in MB</td></tr><tr><td><code>BATCH_PUSH_MAX_SIZE_MB</code></td><td>int</td><td>8</td><td>Maximum batch size in MB (hard limit)</td></tr><tr><td><code>BATCH_PUSH_MIN_MESSAGES</code></td><td>int</td><td>100</td><td>Minimum messages per batch</td></tr><tr><td><code>BATCH_PUSH_MAX_MESSAGES</code></td><td>int</td><td>10000</td><td>Maximum messages per batch</td></tr><tr><td><code>BATCH_PUSH_CHUNK_SIZE</code></td><td>int</td><td>1000</td><td><strong>LEGACY</strong>: Count-based chunk size (if size-based disabled)</td></tr></tbody></table><p><strong>How it works:</strong></p><ul><li>Estimates total row size for each message (payload + indexes + overhead)</li><li>Dynamically accumulates messages until reaching optimal batch size</li><li>Ensures batches stay within PostgreSQL&#39;s sweet spot of 2-8 MB</li><li>Falls back to legacy count-based batching if disabled</li></ul><p><strong>Recommended Settings by Workload:</strong></p><table tabindex="0"><thead><tr><th>Workload</th><th>TARGET_SIZE_MB</th><th>MIN_SIZE_MB</th><th>MAX_SIZE_MB</th><th>MIN_MESSAGES</th><th>MAX_MESSAGES</th></tr></thead><tbody><tr><td>Small messages (&lt;1KB)</td><td>6</td><td>3</td><td>10</td><td>500</td><td>20000</td></tr><tr><td>Medium messages (1-10KB)</td><td>4</td><td>2</td><td>8</td><td>100</td><td>10000</td></tr><tr><td>Large messages (&gt;10KB)</td><td>3</td><td>2</td><td>6</td><td>50</td><td>5000</td></tr><tr><td>Mixed workload</td><td>4</td><td>2</td><td>8</td><td>100</td><td>10000</td></tr></tbody></table><h3 id="response-queue" tabindex="-1">Response Queue <a class="header-anchor" href="#response-queue" aria-label="Permalink to &quot;Response Queue&quot;">​</a></h3><p>Response processing uses an adaptive batching system that automatically scales up under load to prevent backlog buildup.</p><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>RESPONSE_TIMER_INTERVAL_MS</code></td><td>int</td><td>25</td><td>Response queue polling interval (ms)</td></tr><tr><td><code>RESPONSE_BATCH_SIZE</code></td><td>int</td><td>100</td><td>Base number of responses to process per timer tick</td></tr><tr><td><code>RESPONSE_BATCH_MAX</code></td><td>int</td><td>500</td><td>Maximum responses per tick under heavy backlog</td></tr></tbody></table><p><strong>How Adaptive Batching Works:</strong></p><p>Under normal load, the system processes <code>RESPONSE_BATCH_SIZE</code> responses every timer tick. When backlog is detected, it automatically scales up:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Normal (&lt; 100 items):     100 responses per tick</span></span>
<span class="line"><span>Moderate (200 items):     200 responses per tick (2x)</span></span>
<span class="line"><span>High (300 items):         300 responses per tick (3x)</span></span>
<span class="line"><span>Heavy (500+ items):       500 responses per tick (capped at max)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The system logs warnings when backlog exceeds 2x the base batch size.</p><p><strong>Throughput Calculations:</strong></p><p>At default settings (25ms interval):</p><ul><li>Normal: 4,000 responses/sec per worker</li><li>Maximum: 20,000 responses/sec per worker</li></ul><p><strong>Configuration Examples:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Default balanced configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Low latency (more responsive, higher CPU)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High throughput (handles large backlogs)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Conservative (lower CPU, can backlog under load)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Tuning Guidelines</p><ul><li>Increase <code>RESPONSE_BATCH_SIZE</code> if you frequently see backlog warnings</li><li>Increase <code>RESPONSE_BATCH_MAX</code> for burst traffic handling</li><li>Lower <code>RESPONSE_TIMER_INTERVAL_MS</code> for lower latency (increases CPU)</li><li>The system automatically adapts between base and max based on queue depth</li></ul></div><h2 id="queue-defaults" tabindex="-1">Queue Defaults <a class="header-anchor" href="#queue-defaults" aria-label="Permalink to &quot;Queue Defaults&quot;">​</a></h2><h3 id="basic-defaults" tabindex="-1">Basic Defaults <a class="header-anchor" href="#basic-defaults" aria-label="Permalink to &quot;Basic Defaults&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_LEASE_TIME</code></td><td>int</td><td>300</td><td>Default lease time in seconds (5 minutes)</td></tr><tr><td><code>DEFAULT_RETRY_LIMIT</code></td><td>int</td><td>3</td><td>Default retry limit</td></tr><tr><td><code>DEFAULT_RETRY_DELAY</code></td><td>int</td><td>1000</td><td>Default retry delay (ms)</td></tr><tr><td><code>DEFAULT_MAX_SIZE</code></td><td>int</td><td>10000</td><td>Default maximum queue size</td></tr><tr><td><code>DEFAULT_TTL</code></td><td>int</td><td>3600</td><td>Default message TTL in seconds</td></tr><tr><td><code>DEFAULT_PRIORITY</code></td><td>int</td><td>0</td><td>Default message priority</td></tr><tr><td><code>DEFAULT_DELAYED_PROCESSING</code></td><td>int</td><td>0</td><td>Default delayed processing time (seconds)</td></tr><tr><td><code>DEFAULT_WINDOW_BUFFER</code></td><td>int</td><td>0</td><td>Default window buffer size (seconds)</td></tr></tbody></table><h3 id="dead-letter-queue" tabindex="-1">Dead Letter Queue <a class="header-anchor" href="#dead-letter-queue" aria-label="Permalink to &quot;Dead Letter Queue&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_DLQ_ENABLED</code></td><td>bool</td><td>false</td><td>Enable DLQ by default</td></tr><tr><td><code>DEFAULT_DLQ_AFTER_MAX_RETRIES</code></td><td>bool</td><td>false</td><td>Auto-move to DLQ after max retries</td></tr></tbody></table><h3 id="retention" tabindex="-1">Retention <a class="header-anchor" href="#retention" aria-label="Permalink to &quot;Retention&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_RETENTION_SECONDS</code></td><td>int</td><td>0</td><td>Default retention period (0 = disabled)</td></tr><tr><td><code>DEFAULT_COMPLETED_RETENTION_SECONDS</code></td><td>int</td><td>0</td><td>Retention for completed messages (0 = disabled)</td></tr><tr><td><code>DEFAULT_RETENTION_ENABLED</code></td><td>bool</td><td>false</td><td>Enable retention by default</td></tr></tbody></table><h3 id="eviction" tabindex="-1">Eviction <a class="header-anchor" href="#eviction" aria-label="Permalink to &quot;Eviction&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_MAX_WAIT_TIME_SECONDS</code></td><td>int</td><td>0</td><td>Maximum wait time before eviction (0 = disabled)</td></tr></tbody></table><h3 id="consumer-group-subscription" tabindex="-1">Consumer Group Subscription <a class="header-anchor" href="#consumer-group-subscription" aria-label="Permalink to &quot;Consumer Group Subscription&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_SUBSCRIPTION_MODE</code></td><td>string</td><td>&quot;&quot;</td><td>Default subscription mode for new consumer groups</td></tr></tbody></table><p><strong>Options:</strong></p><ul><li><code>&quot;&quot;</code> (empty) - Process all messages including historical</li><li><code>&quot;new&quot;</code> - Skip historical messages, only process messages after subscription</li><li><code>&quot;new-only&quot;</code> - Same as &quot;new&quot;</li></ul><p><strong>Use Cases:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Real-time systems - skip historical backlog</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_SUBSCRIPTION_MODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Batch processing - process everything</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_SUBSCRIPTION_MODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Only applies when client doesn&#39;t explicitly specify <code>.subscriptionMode()</code>. Existing consumer groups are not affected.</p></div><h2 id="background-services" tabindex="-1">Background Services <a class="header-anchor" href="#background-services" aria-label="Permalink to &quot;Background Services&quot;">​</a></h2><h3 id="lease-reclamation" tabindex="-1">Lease Reclamation <a class="header-anchor" href="#lease-reclamation" aria-label="Permalink to &quot;Lease Reclamation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>LEASE_RECLAIM_INTERVAL</code></td><td>int</td><td>5000</td><td>Lease reclamation interval (ms)</td></tr></tbody></table><h3 id="retention-service" tabindex="-1">Retention Service <a class="header-anchor" href="#retention-service" aria-label="Permalink to &quot;Retention Service&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>RETENTION_INTERVAL</code></td><td>int</td><td>300000</td><td>Retention service interval (ms) - 5 minutes</td></tr><tr><td><code>RETENTION_BATCH_SIZE</code></td><td>int</td><td>1000</td><td>Retention batch size</td></tr><tr><td><code>PARTITION_CLEANUP_DAYS</code></td><td>int</td><td>7</td><td>Days before partition cleanup</td></tr><tr><td><code>METRICS_RETENTION_DAYS</code></td><td>int</td><td>90</td><td>Days to keep metrics data</td></tr></tbody></table><h3 id="eviction-service" tabindex="-1">Eviction Service <a class="header-anchor" href="#eviction-service" aria-label="Permalink to &quot;Eviction Service&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>EVICTION_INTERVAL</code></td><td>int</td><td>60000</td><td>Eviction service interval (ms) - 1 minute</td></tr><tr><td><code>EVICTION_BATCH_SIZE</code></td><td>int</td><td>1000</td><td>Eviction batch size</td></tr></tbody></table><h3 id="websocket-updates" tabindex="-1">WebSocket Updates <a class="header-anchor" href="#websocket-updates" aria-label="Permalink to &quot;WebSocket Updates&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>QUEUE_DEPTH_UPDATE_INTERVAL</code></td><td>int</td><td>5000</td><td>Queue depth update interval (ms)</td></tr><tr><td><code>SYSTEM_STATS_UPDATE_INTERVAL</code></td><td>int</td><td>10000</td><td>System stats update interval (ms)</td></tr></tbody></table><h2 id="file-buffer-configuration-qos-0-failover" tabindex="-1">File Buffer Configuration (QoS 0 &amp; Failover) <a class="header-anchor" href="#file-buffer-configuration-qos-0-failover" aria-label="Permalink to &quot;File Buffer Configuration (QoS 0 &amp; Failover)&quot;">​</a></h2><p>Queen provides zero-message-loss failover using file-based buffers when PostgreSQL is unavailable.</p><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>FILE_BUFFER_DIR</code></td><td>string</td><td>Platform-specific*</td><td>Directory for file buffers</td></tr><tr><td><code>FILE_BUFFER_FLUSH_MS</code></td><td>int</td><td>100</td><td>How often to scan for complete buffer files (ms)</td></tr><tr><td><code>FILE_BUFFER_MAX_BATCH</code></td><td>int</td><td>100</td><td>Maximum events per database transaction</td></tr><tr><td><code>FILE_BUFFER_EVENTS_PER_FILE</code></td><td>int</td><td>10000</td><td>Create new buffer file after N events</td></tr></tbody></table><p><strong>Platform-specific defaults:</strong></p><ul><li><strong>macOS</strong>: <code>/tmp/queen</code></li><li><strong>Linux</strong>: <code>/var/lib/queen/buffers</code></li></ul><p><strong>How it works:</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Client pushes with { buffer: true } or DB is down</span></span>
<span class="line"><span>2. Event written to: qos0_&lt;uuid&gt;.buf.tmp (active file)</span></span>
<span class="line"><span>3. File finalized when EITHER:</span></span>
<span class="line"><span>   - Reaches 10,000 events (high throughput), OR</span></span>
<span class="line"><span>   - 200ms passes with no new writes (low throughput)</span></span>
<span class="line"><span>4. Atomic rename: .tmp → .buf</span></span>
<span class="line"><span>5. Background processor picks up .buf files every 100ms</span></span>
<span class="line"><span>6. Processes in batches of 100 events per DB transaction</span></span>
<span class="line"><span>7. Deletes file when complete</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Configuration Examples:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High-throughput configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/data/queen/buffers</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_FLUSH_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_MAX_BATCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_EVENTS_PER_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Low-latency configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/data/queen/buffers</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_FLUSH_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_MAX_BATCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_EVENTS_PER_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="encryption-configuration" tabindex="-1">Encryption Configuration <a class="header-anchor" href="#encryption-configuration" aria-label="Permalink to &quot;Encryption Configuration&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>QUEEN_ENCRYPTION_KEY</code></td><td>string</td><td>-</td><td>Encryption key (64 hex characters for AES-256)</td></tr></tbody></table><p><strong>Generate a secure key:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hex</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>Example:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEEN_ENCRYPTION_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">Security</p><ul><li>Uses AES-256-GCM encryption</li><li>Key must be exactly 64 hexadecimal characters (32 bytes)</li><li>Keep key secure and never commit to version control</li></ul></div><h2 id="api-configuration" tabindex="-1">API Configuration <a class="header-anchor" href="#api-configuration" aria-label="Permalink to &quot;API Configuration&quot;">​</a></h2><h3 id="general" tabindex="-1">General <a class="header-anchor" href="#general" aria-label="Permalink to &quot;General&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>MAX_BODY_SIZE</code></td><td>int</td><td>104857600</td><td>Maximum request body size (bytes, default 100MB)</td></tr></tbody></table><h3 id="pagination" tabindex="-1">Pagination <a class="header-anchor" href="#pagination" aria-label="Permalink to &quot;Pagination&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>API_DEFAULT_LIMIT</code></td><td>int</td><td>100</td><td>Default pagination limit</td></tr><tr><td><code>API_MAX_LIMIT</code></td><td>int</td><td>1000</td><td>Maximum pagination limit</td></tr><tr><td><code>API_DEFAULT_OFFSET</code></td><td>int</td><td>0</td><td>Default pagination offset</td></tr></tbody></table><h3 id="cors" tabindex="-1">CORS <a class="header-anchor" href="#cors" aria-label="Permalink to &quot;CORS&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>CORS_MAX_AGE</code></td><td>int</td><td>86400</td><td>CORS preflight cache duration (seconds)</td></tr><tr><td><code>CORS_ALLOWED_ORIGINS</code></td><td>string</td><td>*</td><td>Allowed CORS origins</td></tr><tr><td><code>CORS_ALLOWED_METHODS</code></td><td>string</td><td>GET, POST, PUT, DELETE, OPTIONS</td><td>Allowed HTTP methods</td></tr><tr><td><code>CORS_ALLOWED_HEADERS</code></td><td>string</td><td>Content-Type, Authorization</td><td>Allowed request headers</td></tr></tbody></table><h2 id="analytics-configuration" tabindex="-1">Analytics Configuration <a class="header-anchor" href="#analytics-configuration" aria-label="Permalink to &quot;Analytics Configuration&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>ANALYTICS_RECENT_HOURS</code></td><td>int</td><td>24</td><td>Hours for recent completion calculations</td></tr><tr><td><code>ANALYTICS_MIN_COMPLETED</code></td><td>int</td><td>5</td><td>Minimum completed messages for stats</td></tr><tr><td><code>RECENT_MESSAGE_WINDOW</code></td><td>int</td><td>60</td><td>Recent message window (seconds)</td></tr><tr><td><code>RELATED_MESSAGE_WINDOW</code></td><td>int</td><td>3600</td><td>Related message window (seconds)</td></tr><tr><td><code>MAX_RELATED_MESSAGES</code></td><td>int</td><td>10</td><td>Maximum related messages to return</td></tr></tbody></table><h2 id="monitoring-configuration" tabindex="-1">Monitoring Configuration <a class="header-anchor" href="#monitoring-configuration" aria-label="Permalink to &quot;Monitoring Configuration&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>ENABLE_REQUEST_COUNTING</code></td><td>bool</td><td>true</td><td>Enable request counting</td></tr><tr><td><code>ENABLE_MESSAGE_COUNTING</code></td><td>bool</td><td>true</td><td>Enable message counting</td></tr><tr><td><code>METRICS_ENDPOINT_ENABLED</code></td><td>bool</td><td>true</td><td>Enable /metrics endpoint</td></tr><tr><td><code>HEALTH_CHECK_ENABLED</code></td><td>bool</td><td>true</td><td>Enable /health endpoint</td></tr></tbody></table><h2 id="logging-configuration" tabindex="-1">Logging Configuration <a class="header-anchor" href="#logging-configuration" aria-label="Permalink to &quot;Logging Configuration&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>ENABLE_LOGGING</code></td><td>bool</td><td>true</td><td>Enable logging</td></tr><tr><td><code>LOG_LEVEL</code></td><td>string</td><td>info</td><td>Log level</td></tr><tr><td><code>LOG_FORMAT</code></td><td>string</td><td>json</td><td>Log format (json, text)</td></tr><tr><td><code>LOG_TIMESTAMP</code></td><td>bool</td><td>true</td><td>Include timestamps in logs</td></tr></tbody></table><p><strong>Log Levels:</strong></p><ul><li><code>trace</code> - Extremely verbose (development only)</li><li><code>debug</code> - Detailed debugging information</li><li><code>info</code> - General information (recommended for production)</li><li><code>warn</code> - Warnings only</li><li><code>error</code> - Errors only</li><li><code>critical</code> - Critical errors only</li><li><code>off</code> - Disable logging</li></ul><p><strong>Examples:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Development</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">debug</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_FORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_FORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="system-events-configuration" tabindex="-1">System Events Configuration <a class="header-anchor" href="#system-events-configuration" aria-label="Permalink to &quot;System Events Configuration&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>QUEEN_SYSTEM_EVENTS_ENABLED</code></td><td>bool</td><td>false</td><td>Enable system event propagation</td></tr><tr><td><code>QUEEN_SYSTEM_EVENTS_BATCH_MS</code></td><td>int</td><td>10</td><td>Batching window for event publishing (ms)</td></tr><tr><td><code>QUEEN_SYSTEM_EVENTS_SYNC_TIMEOUT</code></td><td>int</td><td>30000</td><td>Startup synchronization timeout (ms)</td></tr></tbody></table><h2 id="configuration-examples" tabindex="-1">Configuration Examples <a class="header-anchor" href="#configuration-examples" aria-label="Permalink to &quot;Configuration Examples&quot;">​</a></h2><h3 id="development-environment" tabindex="-1">Development Environment <a class="header-anchor" href="#development-environment" aria-label="Permalink to &quot;Development Environment&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6632</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_DB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_dev</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">debug</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_FORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="production-environment" tabindex="-1">Production Environment <a class="header-anchor" href="#production-environment" aria-label="Permalink to &quot;Production Environment&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6632</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.production.example.com</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5432</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secure_password</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_DB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USE_SSL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_SSL_REJECT_UNAUTHORIZED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_FORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEEN_ENCRYPTION_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your_64_char_hex_key_here</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/lib/queen/buffers</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="high-throughput-configuration" tabindex="-1">High-Throughput Configuration <a class="header-anchor" href="#high-throughput-configuration" aria-label="Permalink to &quot;High-Throughput Configuration&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BATCH_INSERT_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BATCH_PUSH_TARGET_SIZE_MB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BATCH_PUSH_MAX_SIZE_MB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_PARTITION_CANDIDATES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RETENTION_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EVICTION_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_FLUSH_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_MAX_BATCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_EVENTS_PER_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="real-time-system-skip-historical-messages" tabindex="-1">Real-Time System (Skip Historical Messages) <a class="header-anchor" href="#real-time-system-skip-historical-messages" aria-label="Permalink to &quot;Real-Time System (Skip Historical Messages)&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6632</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.production.example.com</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secure_password</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_DB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queen_production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PG_USE_SSL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_SUBSCRIPTION_MODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # New consumer groups skip historical</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="low-latency-configuration" tabindex="-1">Low-Latency Configuration <a class="header-anchor" href="#low-latency-configuration" aria-label="Permalink to &quot;Low-Latency Configuration&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NUM_WORKERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FILE_BUFFER_FLUSH_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;Notes&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">Boolean Values</p><p>Set to <code>&quot;true&quot;</code> to enable, any other value (including unset) is treated as false.</p></div><div class="tip custom-block"><p class="custom-block-title">Integer Values</p><p>Must be valid integers, invalid values will fall back to defaults.</p></div><div class="warning custom-block"><p class="custom-block-title">Encryption Key</p><p>Must be exactly 64 hexadecimal characters (32 bytes). Generate with: <code>openssl rand -hex 32</code></p></div><div class="info custom-block"><p class="custom-block-title">Timeouts</p><p>All timeout values are in milliseconds unless specified as seconds.</p></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="pool-exhaustion" tabindex="-1">Pool Exhaustion <a class="header-anchor" href="#pool-exhaustion" aria-label="Permalink to &quot;Pool Exhaustion&quot;">​</a></h3><p><strong>Symptom:</strong> &quot;Database connection pool timeout&quot; errors</p><p><strong>Solution:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Increase pool</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_POOL_ACQUISITION_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # More patience</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="high-cpu-usage" tabindex="-1">High CPU Usage <a class="header-anchor" href="#high-cpu-usage" aria-label="Permalink to &quot;High CPU Usage&quot;">​</a></h3><p><strong>Symptom:</strong> CPU constantly high</p><p><strong>Solution:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Reduce registry checks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Less aggressive polling</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Higher backoff ceiling</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="slow-message-delivery" tabindex="-1">Slow Message Delivery <a class="header-anchor" href="#slow-message-delivery" aria-label="Permalink to &quot;Slow Message Delivery&quot;">​</a></h3><p><strong>Symptom:</strong> Messages take long to be consumed</p><p><strong>Solution:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_WORKER_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # More responsive</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> POLL_DB_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Faster initial query</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUE_MAX_POLL_INTERVAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Lower ceiling</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="database-connection-issues" tabindex="-1">Database Connection Issues <a class="header-anchor" href="#database-connection-issues" aria-label="Permalink to &quot;Database Connection Issues&quot;">​</a></h3><p><strong>Symptom:</strong> Can&#39;t connect to PostgreSQL</p><p><strong>Solution:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_CONNECTION_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # More time to connect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_STATEMENT_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # More time for queries</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DB_MAX_RETRIES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # More retry attempts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="response-queue-backlog" tabindex="-1">Response Queue Backlog <a class="header-anchor" href="#response-queue-backlog" aria-label="Permalink to &quot;Response Queue Backlog&quot;">​</a></h3><p><strong>Symptom:</strong> &quot;Response queue backlog detected&quot; warnings in logs</p><p><strong>Solution:</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Process more per tick</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_BATCH_MAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Higher ceiling for bursts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RESPONSE_TIMER_INTERVAL_MS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Check more frequently (higher CPU)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="/queen/server/configuration.html">Server Configuration</a> - General configuration guide</li><li><a href="/queen/server/tuning.html">Performance Tuning</a> - Tuning for different workloads</li><li><a href="/queen/server/deployment.html">Deployment</a> - Production deployment patterns</li><li><a href="/queen/server/troubleshooting.html">Troubleshooting</a> - Common issues and solutions</li></ul>`,172)])])}const E=i(e,[["render",l]]);export{c as __pageData,E as default};
