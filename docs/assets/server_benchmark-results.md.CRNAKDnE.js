import{a,_ as i,c as t,b as n,d as e,e as r}from"./chunks/cg2.C4JXn7Oc.js";import{_ as l,c as h,o as p,ag as o}from"./chunks/framework.-kPtTt-D.js";const y=JSON.parse('{"title":"Production Benchmark Results","description":"","frontmatter":{},"headers":[],"relativePath":"server/benchmark-results.md","filePath":"server/benchmark-results.md"}'),d={name:"server/benchmark-results.md"};function k(u,s,g,c,m,F){return p(),h("div",null,[...s[0]||(s[0]=[o(`<h1 id="production-benchmark-results" tabindex="-1">Production Benchmark Results <a class="header-anchor" href="#production-benchmark-results" aria-label="Permalink to &quot;Production Benchmark Results&quot;">​</a></h1><p>Real-world performance testing of Queen MQ under sustained production-like workloads.</p><h2 id="test-environment" tabindex="-1">Test Environment <a class="header-anchor" href="#test-environment" aria-label="Permalink to &quot;Test Environment&quot;">​</a></h2><ul><li><strong>Hardware</strong>: 32 cores, 64GB RAM, 2TB NVMe disk</li><li><strong>Deployment</strong>: Docker containers (Queen + PostgreSQL)</li><li><strong>Network</strong>: Docker bridge network, no CPU pinning</li><li><strong>Queen Version</strong>: 0.11.0</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Test</th><th>Throughput</th><th>Duration</th><th>Resources</th></tr></thead><tbody><tr><td><strong>Sustained Load</strong></td><td>~10,000 req/s</td><td>3 days continuous</td><td>Queen: 133 MB RAM, ~3 cores</td></tr><tr><td><strong>Batch Push</strong></td><td>~31,000 msg/s</td><td>Sustained</td><td>Disk: ~1 GB/s write</td></tr><tr><td><strong>Consumer Groups</strong></td><td>60,000 msg/s (10 groups)</td><td>Sustained</td><td>Queen: 1 GB RAM, ~3 cores</td></tr></tbody></table><hr><h2 id="_1-sustained-load-test" tabindex="-1">1. Sustained Load Test <a class="header-anchor" href="#_1-sustained-load-test" aria-label="Permalink to &quot;1. Sustained Load Test&quot;">​</a></h2><p><strong>Goal</strong>: Validate Queen can handle continuous high-throughput workloads without degradation.</p><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h3><p><strong>Queen Server</strong>:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --ulimit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nofile=65535:65535</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 6632:6632</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PG_HOST=postgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PG_PASSWORD=postgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NUM_WORKERS=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DB_POOL_SIZE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIDECAR_POOL_SIZE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIDECAR_MICRO_BATCH_WAIT_MS=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  smartnessai/queen-mq:0.11.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>PostgreSQL</strong>:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --ulimit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nofile=65535:65535</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POSTGRES_PASSWORD=postgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5432:5432</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  postgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shared_buffers=4GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max_connections=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max_wal_size=16GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> synchronous_commit=off</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autovacuum_vacuum_cost_limit=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="workload" tabindex="-1">Workload <a class="header-anchor" href="#workload" aria-label="Permalink to &quot;Workload&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Component</th><th>Configuration</th></tr></thead><tbody><tr><td>Queue</td><td>1 queue, 1000 partitions</td></tr><tr><td>Producers</td><td>10 workers, 1000 total connections, 1 msg/request</td></tr><tr><td>Consumer</td><td>1 worker, 50 connections, batch size 50, autoAck</td></tr></tbody></table><h3 id="results" tabindex="-1">Results <a class="header-anchor" href="#results" aria-label="Permalink to &quot;Results&quot;">​</a></h3><p><strong>2+ billion messages processed over 3 days at ~10,000 msg/s</strong></p><p><img src="`+a+'" alt="Sustained Operations"><em>Stable throughput between 9,500-10,500 req/s over the entire test duration</em></p><p><img src="'+i+`" alt="First Billion Messages"><em>First 1.322 billion messages processed</em></p><h3 id="resource-usage" tabindex="-1">Resource Usage <a class="header-anchor" href="#resource-usage" aria-label="Permalink to &quot;Resource Usage&quot;">​</a></h3><p>After 2.5 days of continuous operation:</p><table tabindex="0"><thead><tr><th>Container</th><th>CPU</th><th>Memory</th><th>Network I/O</th><th>Disk I/O</th></tr></thead><tbody><tr><td>Queen</td><td>325%</td><td>146.5 MB</td><td>2.55 TB / 6.64 TB</td><td>14.3 MB / 0 B</td></tr><tr><td>PostgreSQL</td><td>1001%</td><td>46.82 GB</td><td>456 GB / 982 GB</td><td>30.1 GB / 43.3 TB</td></tr></tbody></table><p><strong>Key findings</strong>:</p><ul><li>Queen memory usage remained constant at ~133 MB throughout the test</li><li>Disk usage stabilized at 80 GB with aggressive retention (30-minute message lifetime)</li><li>No performance degradation observed over the test duration</li></ul><hr><h2 id="_2-batch-push-performance" tabindex="-1">2. Batch Push Performance <a class="header-anchor" href="#_2-batch-push-performance" aria-label="Permalink to &quot;2. Batch Push Performance&quot;">​</a></h2><p><strong>Goal</strong>: Test maximum throughput with batched message production.</p><h3 id="configuration-1" tabindex="-1">Configuration <a class="header-anchor" href="#configuration-1" aria-label="Permalink to &quot;Configuration&quot;">​</a></h3><ul><li><strong>Batch size</strong>: 1,000 messages per request</li><li><strong>Message payload</strong>: Standard JSON payload</li></ul><h3 id="postgresql-tuning" tabindex="-1">PostgreSQL Tuning <a class="header-anchor" href="#postgresql-tuning" aria-label="Permalink to &quot;PostgreSQL Tuning&quot;">​</a></h3><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">shared_buffers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1GB </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">temp_buffers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=64MB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">work_mem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=64MB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">max_wal_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=4GB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">min_wal_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1GB</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autovacuum_vacuum_scale_factor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autovacuum_vacuum_threshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autovacuum_vacuum_cost_delay </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autovacuum_vacuum_cost_limit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="results-1" tabindex="-1">Results <a class="header-anchor" href="#results-1" aria-label="Permalink to &quot;Results&quot;">​</a></h3><p><strong>31,170 msg/s sustained throughput</strong></p><p><img src="`+t+'" alt="Batch Throughput"><em>Consistent 30K+ msg/s throughput</em></p><p><img src="'+n+'" alt="Disk Write Speed"><em>Disk write speed approaching 1 GB/s (10 Gbps)</em></p><table tabindex="0"><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody><tr><td>Throughput</td><td>31,170 msg/s</td></tr><tr><td>Disk Write</td><td>~1 GB/s</td></tr><tr><td>Messages/minute</td><td>2M+</td></tr></tbody></table><hr><h2 id="_3-consumer-groups-pub-sub" tabindex="-1">3. Consumer Groups (Pub/Sub) <a class="header-anchor" href="#_3-consumer-groups-pub-sub" aria-label="Permalink to &quot;3. Consumer Groups (Pub/Sub)&quot;">​</a></h2><p><strong>Goal</strong>: Test scalability of consumer group feature with multiple parallel consumers.</p><h3 id="configuration-2" tabindex="-1">Configuration <a class="header-anchor" href="#configuration-2" aria-label="Permalink to &quot;Configuration&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Component</th><th>Configuration</th></tr></thead><tbody><tr><td>Queue</td><td>1 queue, 1000 partitions</td></tr><tr><td>Producer</td><td>1 producer, 100 connections, batch size 10</td></tr><tr><td>Consumers</td><td>10 consumer groups, 5 workers each, 50 connections per worker</td></tr></tbody></table><h3 id="results-2" tabindex="-1">Results <a class="header-anchor" href="#results-2" aria-label="Permalink to &quot;Results&quot;">​</a></h3><p><strong>60,000 msg/s consumption rate</strong> (6K push × 10 consumer groups)</p><p><img src="'+e+'" alt="Consumer Group Peak"><em>Peak performance: 250K msg/s pop throughput during catch-up phase</em></p><p><img src="'+r+'" alt="Consumer Group Steady State"><em>Steady state: 6K push / 60K pop msg/s with ~3 cores and 1 GB RAM</em></p><table tabindex="0"><thead><tr><th>Phase</th><th>Push Rate</th><th>Pop Rate</th><th>CPU Usage</th><th>Memory</th></tr></thead><tbody><tr><td>Catch-up</td><td>N/A</td><td>250,000 msg/s</td><td>10 cores</td><td>1 GB</td></tr><tr><td>Steady state</td><td>6,000 msg/s</td><td>60,000 msg/s</td><td>3 cores</td><td>1 GB</td></tr></tbody></table><hr><h2 id="performance-optimization-notes" tabindex="-1">Performance Optimization Notes <a class="header-anchor" href="#performance-optimization-notes" aria-label="Permalink to &quot;Performance Optimization Notes&quot;">​</a></h2><h3 id="postgresql-tuning-1" tabindex="-1">PostgreSQL Tuning <a class="header-anchor" href="#postgresql-tuning-1" aria-label="Permalink to &quot;PostgreSQL Tuning&quot;">​</a></h3><p>For sustained high-throughput workloads:</p><ol><li><strong>WAL Configuration</strong>: Increase <code>max_wal_size</code> to reduce checkpoint frequency</li><li><strong>Autovacuum</strong>: Aggressive settings prevent dead tuple accumulation</li><li><strong>Synchronous Commit</strong>: <code>off</code> for maximum write performance</li></ol>',53)])])}const B=l(d,[["render",k]]);export{y as __pageData,B as default};
