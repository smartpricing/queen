import{_ as a,c as s,o as i,ag as n}from"./chunks/framework.-kPtTt-D.js";const u=JSON.parse('{"title":"Failover & Recovery","description":"","frontmatter":{},"headers":[],"relativePath":"guide/failover.md","filePath":"guide/failover.md"}'),r={name:"guide/failover.md"};function l(t,e,o,p,c,h){return i(),s("div",null,[...e[0]||(e[0]=[n(`<h1 id="failover-recovery" tabindex="-1">Failover &amp; Recovery <a class="header-anchor" href="#failover-recovery" aria-label="Permalink to &quot;Failover &amp; Recovery&quot;">​</a></h1><p>Automatic failover to disk when PostgreSQL is unavailable - zero message loss guaranteed.</p><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Normal Operation:</span></span>
<span class="line"><span>Client → Queen Server → PostgreSQL ✅</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PostgreSQL Down:</span></span>
<span class="line"><span>Client → Queen Server → File Buffer ✅</span></span>
<span class="line"><span>                     ↓ (retry in background)</span></span>
<span class="line"><span>                     → PostgreSQL (when recovered)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="zero-message-loss" tabindex="-1">Zero Message Loss <a class="header-anchor" href="#zero-message-loss" aria-label="Permalink to &quot;Zero Message Loss&quot;">​</a></h2><p>Queen automatically:</p><ol><li>Detects PostgreSQL unavailability</li><li>Buffers messages to disk</li><li>Returns success to client</li><li>Replays messages when database recovers</li></ol><p><strong>No configuration needed</strong> - failover is automatic!</p><h2 id="file-buffer-location" tabindex="-1">File Buffer Location <a class="header-anchor" href="#file-buffer-location" aria-label="Permalink to &quot;File Buffer Location&quot;">​</a></h2><p><strong>Linux:</strong> <code>/var/lib/queen/buffers/</code><br><strong>macOS:</strong> <code>/tmp/queen/</code></p><p>Custom location:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FILE_BUFFER_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/custom/path</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./bin/queen-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to &quot;Features&quot;">​</a></h2><ul><li>✅ Zero message loss</li><li>✅ FIFO ordering preserved</li><li>✅ Automatic recovery</li><li>✅ Survives server crashes</li><li>✅ No client changes needed</li></ul><h2 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check buffer files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/queen/buffers/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Count buffered events</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/queen/buffers/failover_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.buf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="recovery-performance" tabindex="-1">Recovery Performance <a class="header-anchor" href="#recovery-performance" aria-label="Permalink to &quot;Recovery Performance&quot;">​</a></h2><ul><li><strong>Recovery rate</strong>: ~10,000 events/second</li><li><strong>Example</strong>: 1M buffered events = ~100 seconds recovery</li></ul><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><ol><li><strong>Provision disk space</strong> for peak traffic (2-4 hours)</li><li><strong>Monitor buffer directory</strong> for file buildup</li><li><strong>Alert on database outages</strong> proactively</li><li><strong>Test failover</strong> regularly</li></ol><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="/queen/server/architecture.html">Server Architecture</a></li><li><a href="/queen/server/tuning.html">Performance Tuning</a></li></ul><p><a href="https://github.com/smartpricing/queen/blob/master/documentation/FAILOVER.md" target="_blank" rel="noreferrer">Complete failover documentation</a></p>`,23)])])}const b=a(r,[["render",l]]);export{u as __pageData,b as default};
