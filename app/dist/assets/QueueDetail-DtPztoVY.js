import{c as V,G as et,h as v,l as st,a as i,d as g,b as e,F as z,j as O,t as a,k as c,u as p,f as m,A as U,B as E,n as B,D as R,v as G,y as lt,H as ot,E as at,o as r}from"./index-DukDhp_y.js";const nt={class:"space-y-6 animate-fade-in"},it={key:0,class:"space-y-6"},rt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},dt={class:"card p-5"},ut={class:"flex items-center justify-between mb-3"},ct={class:"flex items-center gap-3"},pt={class:"text-xl font-bold font-display text-light-900 dark:text-white"},mt={class:"flex gap-2"},vt={class:"flex flex-wrap gap-x-6 gap-y-1 text-sm text-light-600 dark:text-light-400"},gt={key:0},xt={key:1},ft={class:"text-xs text-light-500"},kt={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},ht={class:"card p-4"},bt={class:"text-2xl font-bold font-display text-light-900 dark:text-white mt-1"},yt={class:"card p-4"},wt={class:"text-2xl font-bold font-display text-cyber-600 dark:text-cyber-400 mt-1"},Ct={class:"card p-4"},Mt={class:"text-2xl font-bold font-display text-crown-600 dark:text-crown-400 mt-1"},Lt={class:"card p-4"},jt={class:"text-2xl font-bold font-display text-emerald-600 dark:text-emerald-400 mt-1"},Dt={class:"card p-4"},Pt={class:"text-2xl font-bold font-display text-rose-600 dark:text-rose-400 mt-1"},$t={key:0,class:"card p-5"},_t={class:"grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-3 text-sm"},qt={class:"font-semibold"},Bt={class:"font-semibold"},Qt={class:"font-semibold"},St={class:"font-semibold"},Nt={class:"font-semibold"},Tt={class:"font-semibold"},Vt={class:"card"},At={class:"card-header flex items-center justify-between"},Ft={class:"flex items-center gap-3"},zt={class:"badge badge-queen"},Ut={class:"w-48"},Et={class:"overflow-x-auto"},Ht={class:"table"},Jt={class:"flex items-center gap-1"},Ot={class:"flex items-center justify-end gap-1"},Rt={class:"flex items-center justify-end gap-1"},Gt={class:"flex items-center justify-end gap-1"},Yt={class:"flex items-center justify-end gap-1"},It={class:"font-medium text-light-900 dark:text-light-100"},Kt={key:0,class:"text-xs text-light-500 mt-0.5"},Wt={class:"text-right font-medium tabular-nums"},Xt={class:"text-right font-medium tabular-nums"},Zt={class:"text-right font-medium tabular-nums text-emerald-600 dark:text-emerald-400"},te={class:"text-right font-medium tabular-nums text-rose-600 dark:text-rose-400"},ee={class:"text-right"},se={class:"text-sm tabular-nums"},le={class:"text-xs text-light-500"},oe={key:0},ae={key:2,class:"card p-6 text-rose-600 dark:text-rose-400"},ne={class:"text-sm"},ie={class:"card-body space-y-4"},re={class:"px-5 py-4 border-t border-light-200 dark:border-dark-50 flex items-center justify-end gap-3"},de={class:"card-body"},ue={class:"text-light-600 dark:text-light-400"},ce={class:"px-5 py-4 border-t border-light-200 dark:border-dark-50 flex items-center justify-end gap-3"},ve={__name:"QueueDetail",setup(pe){const Y=et();at();const f=V(()=>Y.params.queueName),A=v(!0),b=v(null),d=v(null),Q=v(null),S=v(""),N=v("name"),k=v("asc"),y=v(!1),w=v(!1),x=v({partition:"",payload:""}),T=V(()=>{var o,n;const s=((o=Q.value)==null?void 0:o.partitions)||[],t=((n=d.value)==null?void 0:n.partitions)||[];return s.length>0?s:t.map(u=>({...u,messages:u.stats||u.messages||{}}))}),h=V(()=>{const s={total:0,pending:0,processing:0,completed:0,failed:0,deadLetter:0};for(const t of T.value){const o=t.messages||t.stats||{};s.total+=o.total||0,s.pending+=o.pending||0,s.processing+=o.processing||0,s.completed+=o.completed||0,s.failed+=o.failed||0,s.deadLetter+=o.deadLetter||0}return s}),H=V(()=>{let s=[...T.value];if(S.value){const t=S.value.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(t))}return s.sort((t,o)=>{var L,j,l,D,P,$,_,q;let n,u;switch(N.value){case"name":n=t.name.toLowerCase(),u=o.name.toLowerCase();break;case"pending":n=((L=t.messages)==null?void 0:L.pending)||0,u=((j=o.messages)==null?void 0:j.pending)||0;break;case"processing":n=((l=t.messages)==null?void 0:l.processing)||0,u=((D=o.messages)==null?void 0:D.processing)||0;break;case"completed":n=((P=t.messages)==null?void 0:P.completed)||0,u=(($=o.messages)==null?void 0:$.completed)||0;break;case"failed":n=((_=t.messages)==null?void 0:_.failed)||0,u=((q=o.messages)==null?void 0:q.failed)||0;break;default:return 0}return typeof n=="string"?k.value==="asc"?n.localeCompare(u):u.localeCompare(n):k.value==="asc"?n-u:u-n}),s}),C=s=>{N.value===s?k.value=k.value==="asc"?"desc":"asc":(N.value=s,k.value="asc")},M=s=>N.value!==s?"opacity-30":k.value==="asc"?"":"rotate-180",F=async()=>{var s,t;A.value=!0,b.value=null;try{const[o,n]=await Promise.all([G.get(f.value).catch(()=>null),lt.getQueueDetail(f.value).catch(()=>null)]);d.value=(o==null?void 0:o.data)||null,Q.value=(n==null?void 0:n.data)||null,!d.value&&!Q.value&&(b.value="Queue not found")}catch(o){b.value=((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.error)||o.message}finally{A.value=!1}},I=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",K=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"-",W=s=>!s||s===0?"0s":s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m`:s<86400?`${Math.floor(s/3600)}h`:`${Math.floor(s/86400)}d`,X=()=>{w.value=!0},Z=async()=>{try{await G.clear(f.value),w.value=!1,F()}catch(s){console.error("Failed to clear queue:",s)}},tt=async()=>{try{const s=JSON.parse(x.value.payload);await ot.push({queue:f.value,partition:x.value.partition||void 0,messages:[{payload:s}]}),y.value=!1,x.value={partition:"",payload:""},F()}catch(s){console.error("Failed to push message:",s)}};return st(F),(s,t)=>{var o,n,u,L,j;return r(),i("div",nt,[A.value?(r(),i("div",it,[t[17]||(t[17]=e("div",{class:"card p-5"},[e("div",{class:"skeleton h-8 w-48 mb-4"}),e("div",{class:"skeleton h-4 w-64"})],-1)),e("div",rt,[(r(),i(z,null,O(4,l=>e("div",{key:l,class:"card p-4"},[...t[16]||(t[16]=[e("div",{class:"skeleton h-4 w-20 mb-2"},null,-1),e("div",{class:"skeleton h-8 w-16"},null,-1)])])),64))])])):d.value||Q.value?(r(),i(z,{key:1},[e("div",dt,[e("div",ut,[e("div",ct,[e("button",{onClick:t[0]||(t[0]=l=>s.$router.push("/queues")),class:"p-2 hover:bg-light-100 dark:hover:bg-dark-300 rounded-lg transition-colors"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5 text-light-600 dark:text-light-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),e("h1",pt,a(((o=d.value)==null?void 0:o.name)||f.value),1)]),e("div",mt,[e("button",{onClick:t[1]||(t[1]=l=>y.value=!0),class:"btn btn-primary"},[...t[19]||(t[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),c(" Push Message ",-1)])]),e("button",{onClick:X,class:"btn btn-secondary"},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),c(" Clear ",-1)])])])]),e("div",vt,[(n=d.value)!=null&&n.namespace?(r(),i("span",gt,[t[21]||(t[21]=e("span",{class:"text-light-500"},"Namespace:",-1)),c(" "+a(d.value.namespace),1)])):g("",!0),(u=d.value)!=null&&u.task?(r(),i("span",xt,[t[22]||(t[22]=e("span",{class:"text-light-500"},"Task:",-1)),c(" "+a(d.value.task),1)])):g("",!0),e("span",null,[t[23]||(t[23]=e("span",{class:"text-light-500"},"Partitions:",-1)),c(" "+a(T.value.length),1)]),e("span",ft," Created: "+a(I((L=d.value)==null?void 0:L.createdAt)),1)])]),e("div",kt,[e("div",ht,[t[24]||(t[24]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Total",-1)),e("p",bt,a(p(m)(h.value.total)),1)]),e("div",yt,[t[25]||(t[25]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Pending",-1)),e("p",wt,a(p(m)(h.value.pending)),1)]),e("div",Ct,[t[26]||(t[26]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Processing",-1)),e("p",Mt,a(p(m)(h.value.processing)),1)]),e("div",Lt,[t[27]||(t[27]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Completed",-1)),e("p",jt,a(p(m)(h.value.completed)),1)]),e("div",Dt,[t[28]||(t[28]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Failed / DLQ",-1)),e("p",Pt,a(p(m)(h.value.failed+h.value.deadLetter)),1)])]),(j=d.value)!=null&&j.config?(r(),i("div",$t,[t[35]||(t[35]=e("h3",{class:"text-sm font-semibold text-light-900 dark:text-white mb-4"},"Queue Configuration",-1)),e("div",_t,[e("div",null,[t[29]||(t[29]=e("span",{class:"text-light-500 block mb-0.5"},"Lease Time",-1)),e("span",qt,a(d.value.config.leaseTime||0)+"s",1)]),e("div",null,[t[30]||(t[30]=e("span",{class:"text-light-500 block mb-0.5"},"TTL",-1)),e("span",Bt,a(W(d.value.config.ttl||0)),1)]),e("div",null,[t[31]||(t[31]=e("span",{class:"text-light-500 block mb-0.5"},"Max Queue Size",-1)),e("span",Qt,a(p(m)(d.value.config.maxQueueSize||0)),1)]),e("div",null,[t[32]||(t[32]=e("span",{class:"text-light-500 block mb-0.5"},"Retry Limit",-1)),e("span",St,a(d.value.config.retryLimit||0),1)]),e("div",null,[t[33]||(t[33]=e("span",{class:"text-light-500 block mb-0.5"},"Retry Delay",-1)),e("span",Nt,a(d.value.config.retryDelay||0)+"ms",1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"text-light-500 block mb-0.5"},"DLQ Enabled",-1)),e("span",Tt,a(d.value.config.deadLetterQueue?"Yes":"No"),1)])])])):g("",!0),e("div",Vt,[e("div",At,[e("div",Ft,[t[36]||(t[36]=e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Partitions",-1)),e("span",zt,a(T.value.length)+" partitions",1)]),e("div",Ut,[U(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),type:"text",placeholder:"Search partitions...",class:"input text-sm"},null,512),[[E,S.value]])])]),e("div",Et,[e("table",Ht,[e("thead",null,[e("tr",null,[e("th",{onClick:t[3]||(t[3]=l=>C("name")),class:"cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Jt,[t[38]||(t[38]=c(" Partition ",-1)),(r(),i("svg",{class:B(["w-3 h-3 transition-transform",M("name")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[37]||(t[37]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[4]||(t[4]=l=>C("pending")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Ot,[t[40]||(t[40]=c(" Pending ",-1)),(r(),i("svg",{class:B(["w-3 h-3 transition-transform",M("pending")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[39]||(t[39]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[5]||(t[5]=l=>C("processing")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Rt,[t[42]||(t[42]=c(" Processing ",-1)),(r(),i("svg",{class:B(["w-3 h-3 transition-transform",M("processing")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[41]||(t[41]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[6]||(t[6]=l=>C("completed")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Gt,[t[44]||(t[44]=c(" Completed ",-1)),(r(),i("svg",{class:B(["w-3 h-3 transition-transform",M("completed")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[43]||(t[43]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[7]||(t[7]=l=>C("failed")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Yt,[t[46]||(t[46]=c(" Failed ",-1)),(r(),i("svg",{class:B(["w-3 h-3 transition-transform",M("failed")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[45]||(t[45]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),t[47]||(t[47]=e("th",{class:"text-right"},"Consumed",-1))])]),e("tbody",null,[(r(!0),i(z,null,O(H.value,l=>{var D,P,$,_,q,J;return r(),i("tr",{key:l.id,class:"hover:bg-light-50 dark:hover:bg-dark-300"},[e("td",null,[e("div",It,a(l.name),1),l.lastActivity?(r(),i("div",Kt," Last: "+a(K(l.lastActivity)),1)):g("",!0)]),e("td",Wt,a(p(m)(((D=l.messages)==null?void 0:D.pending)||0)),1),e("td",Xt,a(p(m)(((P=l.messages)==null?void 0:P.processing)||0)),1),e("td",Zt,a(p(m)((($=l.messages)==null?void 0:$.completed)||0)),1),e("td",te,a(p(m)(((_=l.messages)==null?void 0:_.failed)||0)),1),e("td",ee,[e("div",se,a(p(m)(((q=l.cursor)==null?void 0:q.totalConsumed)||0)),1),e("div",le,a(((J=l.cursor)==null?void 0:J.batchesConsumed)||0)+" batches ",1)])])}),128)),H.value.length===0?(r(),i("tr",oe,[...t[48]||(t[48]=[e("td",{colspan:"6",class:"text-center py-8 text-light-500 text-sm"}," No partitions found ",-1)])])):g("",!0)])])])])],64)):b.value?(r(),i("div",ae,[t[49]||(t[49]=e("p",{class:"font-semibold mb-2"},"Error loading queue",-1)),e("p",ne,a(b.value),1)])):g("",!0),y.value?(r(),i("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-dark-500/50 backdrop-blur-sm",onClick:t[12]||(t[12]=l=>y.value=!1)},[e("div",{class:"card w-full max-w-lg animate-slide-up",onClick:t[11]||(t[11]=R(()=>{},["stop"]))},[t[52]||(t[52]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Push Message")],-1)),e("div",ie,[e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-light-700 dark:text-light-300 mb-1.5"}," Partition (optional) ",-1)),U(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>x.value.partition=l),type:"text",placeholder:"Leave empty for default",class:"input"},null,512),[[E,x.value.partition]])]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-light-700 dark:text-light-300 mb-1.5"}," Payload (JSON) ",-1)),U(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=l=>x.value.payload=l),rows:"6",class:"input font-mono text-sm",placeholder:'{"key": "value"}'},null,512),[[E,x.value.payload]])])]),e("div",re,[e("button",{onClick:t[10]||(t[10]=l=>y.value=!1),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:tt,class:"btn btn-primary"}," Push Message ")])])])):g("",!0),w.value?(r(),i("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-dark-500/50 backdrop-blur-sm",onClick:t[15]||(t[15]=l=>w.value=!1)},[e("div",{class:"card w-full max-w-md animate-slide-up",onClick:t[14]||(t[14]=R(()=>{},["stop"]))},[t[55]||(t[55]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Clear Queue")],-1)),e("div",de,[e("p",ue,[t[53]||(t[53]=c(" Are you sure you want to clear all messages from ",-1)),e("strong",null,a(f.value),1),t[54]||(t[54]=c("? This action cannot be undone. ",-1))])]),e("div",ce,[e("button",{onClick:t[13]||(t[13]=l=>w.value=!1),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:Z,class:"btn bg-rose-600 text-white hover:bg-rose-700"}," Clear Queue ")])])])):g("",!0)])}}};export{ve as default};
