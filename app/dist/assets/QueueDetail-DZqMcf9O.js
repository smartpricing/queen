import{c as N,G as K,g as v,k as O,a as d,d as x,b as e,F as V,i as z,t as l,j as m,u as g,A as W,B as X,n as $,D as Z,v as E,y as tt,E as et,o as u}from"./index-Bh6pUXf_.js";import{f as p}from"./useApi-CMkbhU7m.js";const st={class:"space-y-4 sm:space-y-6 animate-fade-in"},ot={key:0,class:"space-y-4 sm:space-y-6"},lt={class:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4"},nt={class:"card p-5"},at={class:"flex items-center justify-between mb-3"},it={class:"flex items-center gap-3"},rt={class:"text-xl font-bold font-display text-light-900 dark:text-white"},dt={class:"flex flex-wrap gap-x-6 gap-y-1 text-sm text-light-600 dark:text-light-400"},ut={key:0},ct={key:1},mt={class:"text-xs text-light-500"},gt={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 sm:gap-4"},pt={class:"card p-4"},vt={class:"text-2xl font-bold font-display text-light-900 dark:text-white mt-1"},xt={class:"card p-4"},ft={class:"text-2xl font-bold font-display text-cyber-600 dark:text-cyber-400 mt-1"},ht={class:"card p-4"},kt={class:"text-2xl font-bold font-display text-crown-600 dark:text-crown-400 mt-1"},bt={class:"card p-4"},yt={class:"text-2xl font-bold font-display text-emerald-600 dark:text-emerald-400 mt-1"},wt={class:"card p-4"},Ct={class:"text-2xl font-bold font-display text-rose-600 dark:text-rose-400 mt-1"},_t={key:0,class:"card p-5"},Dt={class:"grid grid-cols-2 md:grid-cols-3 gap-x-3 sm:gap-x-6 gap-y-2 sm:gap-y-3 text-xs sm:text-sm"},Lt={class:"font-semibold"},qt={class:"font-semibold"},Mt={class:"font-semibold"},jt={class:"font-semibold"},Qt={class:"font-semibold"},$t={class:"font-semibold"},Tt={class:"card"},Pt={class:"card-header flex items-center justify-between"},Bt={class:"flex items-center gap-3"},Nt={class:"badge badge-queen"},St={class:"w-48"},Vt={class:"overflow-x-auto"},At={class:"table"},Ft={class:"flex items-center gap-1"},zt={class:"flex items-center justify-end gap-1"},Et={class:"flex items-center justify-end gap-1"},Ut={class:"flex items-center justify-end gap-1"},Rt={class:"flex items-center justify-end gap-1"},Gt={class:"font-medium text-light-900 dark:text-light-100"},Ht={key:0,class:"text-xs text-light-500 mt-0.5"},Yt={class:"text-right font-medium tabular-nums"},It={class:"text-right font-medium tabular-nums"},Jt={class:"text-right font-medium tabular-nums text-emerald-600 dark:text-emerald-400"},Kt={class:"text-right font-medium tabular-nums text-rose-600 dark:text-rose-400"},Ot={class:"text-right"},Wt={class:"text-sm tabular-nums"},Xt={class:"text-xs text-light-500"},Zt={key:0},te={key:2,class:"card p-6 text-rose-600 dark:text-rose-400"},ee={class:"text-sm"},se={class:"card-body"},oe={class:"text-light-600 dark:text-light-400"},le={class:"px-5 py-4 border-t border-light-200 dark:border-dark-50 flex items-center justify-end gap-3"},re={__name:"QueueDetail",setup(ne){const U=K(),R=et(),b=N(()=>U.params.queueName),S=v(!0),y=v(null),r=v(null),f=v(null),T=v(""),P=v("name"),h=v("asc"),w=v(!1),B=N(()=>{var i,o;const s=((i=f.value)==null?void 0:i.partitions)||[],t=((o=r.value)==null?void 0:o.partitions)||[];return s.length>0?s:t.map(n=>({...n,messages:n.stats||n.messages||{}}))}),k=N(()=>{var i;const s=(i=f.value)==null?void 0:i.totals;if(s){const o=s.messages||s;return{total:o.total||0,pending:o.pending||0,processing:o.processing||0,completed:o.completed||0,failed:o.failed||0,deadLetter:o.deadLetter||0}}const t={total:0,pending:0,processing:0,completed:0,failed:0,deadLetter:0};for(const o of B.value){const n=o.messages||o.stats||{};t.total+=n.total||0,t.pending+=n.pending||0,t.processing+=n.processing||0,t.completed+=n.completed||0,t.failed+=n.failed||0,t.deadLetter+=n.deadLetter||0}return t}),A=N(()=>{let s=[...B.value];if(T.value){const t=T.value.toLowerCase();s=s.filter(i=>i.name.toLowerCase().includes(t))}return s.sort((t,i)=>{var c,D,a,L,q,M,j,Q;let o,n;switch(P.value){case"name":o=t.name.toLowerCase(),n=i.name.toLowerCase();break;case"pending":o=((c=t.messages)==null?void 0:c.pending)||0,n=((D=i.messages)==null?void 0:D.pending)||0;break;case"processing":o=((a=t.messages)==null?void 0:a.processing)||0,n=((L=i.messages)==null?void 0:L.processing)||0;break;case"completed":o=((q=t.messages)==null?void 0:q.completed)||0,n=((M=i.messages)==null?void 0:M.completed)||0;break;case"failed":o=((j=t.messages)==null?void 0:j.failed)||0,n=((Q=i.messages)==null?void 0:Q.failed)||0;break;default:return 0}return typeof o=="string"?h.value==="asc"?o.localeCompare(n):n.localeCompare(o):h.value==="asc"?o-n:n-o}),s}),C=s=>{P.value===s?h.value=h.value==="asc"?"desc":"asc":(P.value=s,h.value="asc")},_=s=>P.value!==s?"opacity-30":h.value==="asc"?"":"rotate-180",G=async()=>{var s,t;!r.value&&!f.value&&(S.value=!0),y.value=null;try{const[i,o]=await Promise.all([E.get(b.value).catch(()=>null),tt.getQueueDetail(b.value).catch(()=>null)]),n=(i==null?void 0:i.data)||null,c=(o==null?void 0:o.data)||null;c!=null&&c.queue?r.value={...c.queue,config:c.queue.config}:n?r.value=n:r.value=null,f.value=c,!r.value&&!f.value&&(y.value="Queue not found")}catch(i){y.value=((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.error)||i.message}finally{S.value=!1}},H=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Y=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"-",I=s=>!s||s===0?"0s":s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m`:s<86400?`${Math.floor(s/3600)}h`:`${Math.floor(s/86400)}d`,J=async()=>{try{await E.delete(b.value),w.value=!1,R.push("/queues")}catch(s){console.error("Failed to delete queue:",s)}};return O(G),(s,t)=>{var i,o,n,c,D;return u(),d("div",st,[S.value?(u(),d("div",ot,[t[12]||(t[12]=e("div",{class:"card p-5"},[e("div",{class:"skeleton h-8 w-48 mb-4"}),e("div",{class:"skeleton h-4 w-64"})],-1)),e("div",lt,[(u(),d(V,null,z(4,a=>e("div",{key:a,class:"card p-4"},[...t[11]||(t[11]=[e("div",{class:"skeleton h-4 w-20 mb-2"},null,-1),e("div",{class:"skeleton h-8 w-16"},null,-1)])])),64))])])):r.value||f.value?(u(),d(V,{key:1},[e("div",nt,[e("div",at,[e("div",it,[e("button",{onClick:t[0]||(t[0]=a=>s.$router.push("/queues")),class:"p-2 hover:bg-light-100 dark:hover:bg-dark-300 rounded-lg transition-colors"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5 text-light-600 dark:text-light-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),e("h1",rt,l(((i=r.value)==null?void 0:i.name)||b.value),1)]),e("button",{onClick:t[1]||(t[1]=a=>w.value=!0),class:"btn bg-rose-600 text-white hover:bg-rose-700"},[...t[14]||(t[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),m(" Delete Queue ",-1)])])]),e("div",dt,[(o=r.value)!=null&&o.namespace?(u(),d("span",ut,[t[15]||(t[15]=e("span",{class:"text-light-500"},"Namespace:",-1)),m(" "+l(r.value.namespace),1)])):x("",!0),(n=r.value)!=null&&n.task?(u(),d("span",ct,[t[16]||(t[16]=e("span",{class:"text-light-500"},"Task:",-1)),m(" "+l(r.value.task),1)])):x("",!0),e("span",null,[t[17]||(t[17]=e("span",{class:"text-light-500"},"Partitions:",-1)),m(" "+l(B.value.length),1)]),e("span",mt," Created: "+l(H((c=r.value)==null?void 0:c.createdAt)),1)])]),e("div",gt,[e("div",pt,[t[18]||(t[18]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Total",-1)),e("p",vt,l(g(p)(k.value.total)),1)]),e("div",xt,[t[19]||(t[19]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Pending",-1)),e("p",ft,l(g(p)(k.value.pending)),1)]),e("div",ht,[t[20]||(t[20]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Processing",-1)),e("p",kt,l(g(p)(k.value.processing)),1)]),e("div",bt,[t[21]||(t[21]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Completed",-1)),e("p",yt,l(g(p)(k.value.completed)),1)]),e("div",wt,[t[22]||(t[22]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Failed / DLQ",-1)),e("p",Ct,l(g(p)(k.value.failed+k.value.deadLetter)),1)])]),(D=r.value)!=null&&D.config?(u(),d("div",_t,[t[29]||(t[29]=e("h3",{class:"text-sm font-semibold text-light-900 dark:text-white mb-4"},"Queue Configuration",-1)),e("div",Dt,[e("div",null,[t[23]||(t[23]=e("span",{class:"text-light-500 block mb-0.5"},"Lease Time",-1)),e("span",Lt,l(r.value.config.leaseTime||0)+"s",1)]),e("div",null,[t[24]||(t[24]=e("span",{class:"text-light-500 block mb-0.5"},"TTL",-1)),e("span",qt,l(I(r.value.config.ttl||0)),1)]),e("div",null,[t[25]||(t[25]=e("span",{class:"text-light-500 block mb-0.5"},"Max Queue Size",-1)),e("span",Mt,l(g(p)(r.value.config.maxQueueSize||0)),1)]),e("div",null,[t[26]||(t[26]=e("span",{class:"text-light-500 block mb-0.5"},"Retry Limit",-1)),e("span",jt,l(r.value.config.retryLimit||0),1)]),e("div",null,[t[27]||(t[27]=e("span",{class:"text-light-500 block mb-0.5"},"Retry Delay",-1)),e("span",Qt,l(r.value.config.retryDelay||0)+"ms",1)]),e("div",null,[t[28]||(t[28]=e("span",{class:"text-light-500 block mb-0.5"},"DLQ Enabled",-1)),e("span",$t,l(r.value.config.deadLetterQueue?"Yes":"No"),1)])])])):x("",!0),e("div",Tt,[e("div",Pt,[e("div",Bt,[t[30]||(t[30]=e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Partitions",-1)),e("span",Nt,l(B.value.length)+" partitions",1)]),e("div",St,[W(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>T.value=a),type:"text",placeholder:"Search partitions...",class:"input text-sm"},null,512),[[X,T.value]])])]),e("div",Vt,[e("table",At,[e("thead",null,[e("tr",null,[e("th",{onClick:t[3]||(t[3]=a=>C("name")),class:"cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Ft,[t[32]||(t[32]=m(" Partition ",-1)),(u(),d("svg",{class:$(["w-3 h-3 transition-transform",_("name")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[31]||(t[31]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[4]||(t[4]=a=>C("pending")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",zt,[t[34]||(t[34]=m(" Pending ",-1)),(u(),d("svg",{class:$(["w-3 h-3 transition-transform",_("pending")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[33]||(t[33]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[5]||(t[5]=a=>C("processing")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Et,[t[36]||(t[36]=m(" Processing ",-1)),(u(),d("svg",{class:$(["w-3 h-3 transition-transform",_("processing")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[35]||(t[35]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[6]||(t[6]=a=>C("completed")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Ut,[t[38]||(t[38]=m(" Completed ",-1)),(u(),d("svg",{class:$(["w-3 h-3 transition-transform",_("completed")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[37]||(t[37]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("th",{onClick:t[7]||(t[7]=a=>C("failed")),class:"text-right cursor-pointer hover:text-queen-500 transition-colors"},[e("div",Rt,[t[40]||(t[40]=m(" Failed ",-1)),(u(),d("svg",{class:$(["w-3 h-3 transition-transform",_("failed")]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[39]||(t[39]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),t[41]||(t[41]=e("th",{class:"text-right"},"Consumed",-1))])]),e("tbody",null,[(u(!0),d(V,null,z(A.value,a=>{var L,q,M,j,Q,F;return u(),d("tr",{key:a.id,class:"hover:bg-light-50 dark:hover:bg-dark-300"},[e("td",null,[e("div",Gt,l(a.name),1),a.lastActivity?(u(),d("div",Ht," Last: "+l(Y(a.lastActivity)),1)):x("",!0)]),e("td",Yt,l(g(p)(((L=a.messages)==null?void 0:L.pending)||0)),1),e("td",It,l(g(p)(((q=a.messages)==null?void 0:q.processing)||0)),1),e("td",Jt,l(g(p)(((M=a.messages)==null?void 0:M.completed)||0)),1),e("td",Kt,l(g(p)(((j=a.messages)==null?void 0:j.failed)||0)),1),e("td",Ot,[e("div",Wt,l(g(p)(((Q=a.cursor)==null?void 0:Q.totalConsumed)||0)),1),e("div",Xt,l(((F=a.cursor)==null?void 0:F.batchesConsumed)||0)+" batches ",1)])])}),128)),A.value.length===0?(u(),d("tr",Zt,[...t[42]||(t[42]=[e("td",{colspan:"6",class:"text-center py-8 text-light-500 text-sm"}," No partitions found ",-1)])])):x("",!0)])])])])],64)):y.value?(u(),d("div",te,[t[43]||(t[43]=e("p",{class:"font-semibold mb-2"},"Error loading queue",-1)),e("p",ee,l(y.value),1)])):x("",!0),w.value?(u(),d("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-dark-500/50 backdrop-blur-sm",onClick:t[10]||(t[10]=a=>w.value=!1)},[e("div",{class:"card w-full max-w-md animate-slide-up",onClick:t[9]||(t[9]=Z(()=>{},["stop"]))},[t[46]||(t[46]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Delete Queue")],-1)),e("div",se,[e("p",oe,[t[44]||(t[44]=m(" Are you sure you want to delete ",-1)),e("strong",null,l(b.value),1),t[45]||(t[45]=m("? This will permanently remove the queue and all its messages. This action cannot be undone. ",-1))])]),e("div",le,[e("button",{onClick:t[8]||(t[8]=a=>w.value=!1),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:J,class:"btn bg-rose-600 text-white hover:bg-rose-700"}," Delete Queue ")])])])):x("",!0)])}}};export{re as default};
