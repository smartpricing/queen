import{g as c,c as F,k as Z,a as l,b as t,d as u,A as tt,B as et,J as st,F as C,i as T,j as N,t as a,D as at,n as q,m as lt,p as ot,q as rt,K as V,o}from"./index-Bh6pUXf_.js";import{u as it}from"./useRefresh-DGHeVgd7.js";const nt={class:"space-y-4 sm:space-y-6 animate-fade-in"},dt={class:"card"},ut={class:"card-body"},ct={class:"flex flex-col sm:flex-row gap-3"},xt={class:"flex-1 relative"},vt=["disabled"],ht={key:0,class:"flex flex-wrap items-center gap-2 mt-3 text-xs"},pt=["onClick"],gt={key:0,class:"card bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-700/30"},_t={class:"card-body py-3"},kt={class:"flex items-center gap-3"},mt={class:"text-sm font-semibold text-amber-900 dark:text-amber-100"},bt={class:"text-amber-700 dark:text-amber-300"},ft={class:"text-xs text-amber-700 dark:text-amber-300 mt-0.5"},yt={key:1,class:"card"},wt={key:2,class:"card bg-rose-50 dark:bg-rose-900/20 border-rose-200 dark:border-rose-700/30"},Ct={class:"card-body"},Tt={class:"text-sm text-rose-700 dark:text-rose-300"},Nt={key:3,class:"card"},Mt={class:"overflow-x-auto"},Dt={class:"w-full text-sm"},Et={class:"divide-y divide-light-100 dark:divide-dark-100"},jt=["onClick"],qt={class:"px-4 py-3"},Bt={class:"flex items-center gap-2"},St={class:"text-xs font-semibold uppercase tracking-wide text-light-700 dark:text-light-300"},Pt={class:"px-4 py-3"},Vt={class:"text-xs text-light-600 dark:text-light-400 whitespace-nowrap"},$t={class:"px-4 py-3"},Ut={class:"text-xs font-medium text-light-700 dark:text-light-300"},zt={class:"px-4 py-3"},It={class:"text-xs text-light-600 dark:text-light-400"},Lt={class:"px-4 py-3"},At={class:"text-xs text-light-600 dark:text-light-400 font-mono"},Ot={class:"px-4 py-3"},Qt={key:0,class:"flex flex-wrap gap-1"},Ft={key:1,class:"text-xs text-light-400"},Ht={class:"px-4 py-3 max-w-xs"},Jt={class:"text-xs text-light-700 dark:text-light-300 truncate"},Kt=["title"],Gt={key:1,class:"text-light-500 italic"},Wt={key:2,class:"text-light-400"},Rt={class:"px-4 py-3"},Xt={class:"text-xs text-light-600 dark:text-light-400 space-y-0.5"},Yt=["title"],Zt={key:1,class:"text-light-500"},te={key:2,class:"text-light-400"},ee={key:0,class:"px-4 py-3 border-t border-light-200 dark:border-dark-100 flex items-center justify-between"},se={class:"text-sm text-light-600 dark:text-light-400"},ae={class:"flex gap-2"},le=["disabled"],oe=["disabled"],re={key:4,class:"card"},ie={class:"card-body py-12 text-center"},ne={class:"text-sm text-light-500"},de={class:"font-medium"},ue={key:5,class:"card"},ce={key:0,class:"card-body py-12 text-center"},xe={key:1,class:"card-body"},ve={class:"text-sm text-rose-700 dark:text-rose-300"},he={key:2,class:"card-body py-12 text-center"},pe={key:3,class:"overflow-x-auto"},ge={class:"w-full text-sm"},_e={class:"divide-y divide-light-100 dark:divide-dark-100"},ke=["onClick"],me={class:"px-4 py-3"},be={class:"font-medium text-light-900 dark:text-light-100"},fe={class:"px-4 py-3 text-right"},ye={class:"badge badge-queen"},we={class:"px-4 py-3 text-right"},Ce={class:"badge badge-secondary"},Te={class:"px-4 py-3"},Ne={class:"text-xs text-light-600 dark:text-light-400 whitespace-nowrap"},Me={key:0,class:"px-4 py-3 border-t border-light-200 dark:border-dark-100 flex items-center justify-between"},De={class:"text-sm text-light-600 dark:text-light-400"},Ee={class:"flex gap-2"},je=["disabled"],qe=["disabled"],Be={class:"bg-white dark:bg-dark-300 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden"},Se={class:"px-6 py-4 border-b border-light-200 dark:border-dark-100 flex items-center justify-between"},Pe={class:"flex items-center gap-3"},Ve={class:"font-semibold text-light-900 dark:text-white uppercase tracking-wide"},$e={class:"p-6 overflow-y-auto max-h-[60vh] space-y-4"},Ue={class:"grid grid-cols-2 gap-4 text-sm"},ze={class:"text-light-900 dark:text-light-100"},Ie={class:"text-light-900 dark:text-light-100"},Le={class:"text-light-900 dark:text-light-100"},Ae={class:"font-mono text-light-900 dark:text-light-100 text-xs break-all"},Oe={key:0},Qe={class:"font-mono text-light-900 dark:text-light-100 text-xs break-all"},Fe={key:1},He={class:"text-light-900 dark:text-light-100"},Je={key:0},Ke={class:"flex flex-wrap gap-2"},Ge={key:1},We={key:0,class:"mb-3"},Re={class:"text-sm text-light-900 dark:text-light-100 bg-light-100 dark:bg-dark-200 rounded-lg p-3"},Xe={key:1},Ye={class:"text-xs font-mono bg-light-100 dark:bg-dark-200 rounded-lg p-3 overflow-x-auto text-light-800 dark:text-light-200"},Ze={class:"pt-4 border-t border-light-200 dark:border-dark-100"},ls={__name:"Traces",setup(ts){const g=c(""),d=c(""),h=c([]),k=c(!1),f=c(null),i=c(null),x=c(0),_=c(50),v=c(0),y=c([]),B=c(!1),M=c(null),p=c(0),m=c(20),b=c(0),$=["order-flow-123","tenant-acme","user-workflow"],U=F(()=>new Set(h.value.map(e=>e.transaction_id)).size),z=F(()=>new Set(h.value.map(e=>e.queue_name).filter(Boolean)).size);async function D(){var r,e;if(g.value.trim()){k.value=!0,f.value=null,x.value=0,d.value=g.value.trim();try{const n=await V.getByName(d.value,{limit:_.value,offset:x.value});h.value=n.data.traces||[],v.value=n.data.total||0}catch(n){f.value=((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.error)||n.message,h.value=[],v.value=0}finally{k.value=!1}}}async function S(){var r,e;if(d.value){k.value=!0,f.value=null;try{const n=await V.getByName(d.value,{limit:_.value,offset:x.value});h.value=n.data.traces||[],v.value=n.data.total||0}catch(n){f.value=((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.error)||n.message}finally{k.value=!1}}}function H(){x.value>0&&(x.value=Math.max(0,x.value-_.value),S())}function J(){x.value+_.value<v.value&&(x.value+=_.value,S())}function K(){g.value="",d.value="",h.value=[],v.value=0,x.value=0,w()}function G(r){i.value=r}async function w(){var r,e;y.value.length||(B.value=!0),M.value=null;try{const n=await V.getAvailableNames({limit:m.value,offset:p.value});y.value=n.data.trace_names||[],b.value=n.data.total||0}catch(n){M.value=((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.error)||n.message,y.value=[],b.value=0}finally{B.value=!1}}function W(r){g.value=r,D()}function R(){p.value>0&&(p.value=Math.max(0,p.value-m.value),w())}function X(){p.value+m.value<b.value&&(p.value+=m.value,w())}function I(r){return{info:"bg-blue-500",processing:"bg-emerald-500",step:"bg-violet-500",error:"bg-rose-500",warning:"bg-amber-500"}[r]||"bg-light-400"}function L(r){return!r||typeof r!="object"?!1:Object.keys(r).filter(n=>n!=="text").length>0}function Y(r){if(!r||typeof r!="object")return"";const{text:e,...n}=r;return JSON.stringify(n,null,2)}function P(r){return r?new Date(r).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):""}return it(async()=>{d.value?await S():await w()}),Z(()=>{w()}),(r,e)=>{var A;const n=rt("router-link");return o(),l("div",nt,[t("div",dt,[t("div",ut,[t("div",ct,[t("div",xt,[tt(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onKeyup:st(D,["enter"]),type:"text",placeholder:"Enter trace name (e.g., tenant-acme, order-flow-123)",class:"input w-full pl-10"},null,544),[[et,g.value]]),e[4]||(e[4]=t("svg",{class:"w-5 h-5 text-light-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),t("button",{onClick:D,disabled:!g.value||k.value,class:"btn btn-primary px-6"}," Search ",8,vt),d.value?(o(),l("button",{key:0,onClick:K,class:"btn btn-secondary"}," Clear ")):u("",!0)]),!d.value&&$.length>0?(o(),l("div",ht,[e[5]||(e[5]=t("span",{class:"text-light-500"},"Try:",-1)),(o(),l(C,null,T($,s=>t("button",{key:s,onClick:E=>{g.value=s,D()},class:"px-2 py-1 bg-light-100 dark:bg-dark-200 hover:bg-light-200 dark:hover:bg-dark-100 rounded text-light-700 dark:text-light-300 transition-colors"},a(s),9,pt)),64))])):u("",!0)])]),d.value&&h.value.length>0?(o(),l("div",gt,[t("div",_t,[t("div",kt,[e[6]||(e[6]=t("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[t("p",mt,[N(" Found "+a(v.value)+" trace"+a(v.value!==1?"s":"")+" for: ",1),t("span",bt,a(d.value),1)]),t("p",ft,a(U.value)+" unique message"+a(U.value!==1?"s":"")+" â€¢ "+a(z.value)+" queue"+a(z.value!==1?"s":""),1)])])])])):u("",!0),k.value?(o(),l("div",yt,[...e[7]||(e[7]=[t("div",{class:"card-body py-12 text-center"},[t("div",{class:"spinner mx-auto mb-3"}),t("p",{class:"text-sm text-light-500"},"Loading traces...")],-1)])])):f.value?(o(),l("div",wt,[t("div",Ct,[t("p",Tt,[e[8]||(e[8]=t("strong",null,"Error:",-1)),N(" "+a(f.value),1)])])])):d.value&&h.value.length>0?(o(),l("div",Nt,[t("div",Mt,[t("table",Dt,[e[9]||(e[9]=t("thead",null,[t("tr",{class:"border-b border-light-200 dark:border-dark-100"},[t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Event"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Time"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Queue"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Partition"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Transaction ID"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Trace Names"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Data"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Worker / Group")])],-1)),t("tbody",Et,[(o(!0),l(C,null,T(h.value,s=>{var E,O,Q;return o(),l("tr",{key:s.id,class:"hover:bg-light-50 dark:hover:bg-dark-200 cursor-pointer transition-colors",onClick:j=>G(s)},[t("td",qt,[t("div",Bt,[t("span",{class:q(["w-2 h-2 rounded-full flex-shrink-0",I(s.event_type)])},null,2),t("span",St,a(s.event_type),1)])]),t("td",Pt,[t("span",Vt,a(P(s.created_at)),1)]),t("td",$t,[t("span",Ut,a(s.queue_name||"-"),1)]),t("td",zt,[t("span",It,a(s.partition_name||"-"),1)]),t("td",Lt,[t("span",At,a((E=s.transaction_id)==null?void 0:E.slice(0,8))+"... ",1)]),t("td",Ot,[((O=s.trace_names)==null?void 0:O.length)>0?(o(),l("div",Qt,[(o(!0),l(C,null,T(s.trace_names,j=>(o(),l("span",{key:j,class:q(["badge text-xs",j===d.value?"badge-queen":"badge-secondary"])},a(j),3))),128))])):(o(),l("span",Ft,"-"))]),t("td",Ht,[t("div",Jt,[(Q=s.data)!=null&&Q.text?(o(),l("span",{key:0,title:s.data.text},a(s.data.text),9,Kt)):L(s.data)?(o(),l("span",Gt,"JSON data")):(o(),l("span",Wt,"-"))])]),t("td",Rt,[t("div",Xt,[s.worker_id?(o(),l("div",{key:0,class:"truncate max-w-[120px]",title:s.worker_id},a(s.worker_id),9,Yt)):u("",!0),s.consumer_group&&s.consumer_group!=="__QUEUE_MODE__"?(o(),l("div",Zt,a(s.consumer_group),1)):u("",!0),!s.worker_id&&(!s.consumer_group||s.consumer_group==="__QUEUE_MODE__")?(o(),l("span",te,"-")):u("",!0)])])],8,jt)}),128))])])]),v.value>_.value?(o(),l("div",ee,[t("p",se," Showing "+a(x.value+1)+"-"+a(Math.min(x.value+_.value,v.value))+" of "+a(v.value),1),t("div",ae,[t("button",{onClick:H,disabled:x.value===0,class:"btn btn-secondary text-sm"}," Previous ",8,le),t("button",{onClick:J,disabled:x.value+_.value>=v.value,class:"btn btn-secondary text-sm"}," Next ",8,oe)])])):u("",!0)])):d.value&&h.value.length===0&&!k.value?(o(),l("div",re,[t("div",ie,[e[11]||(e[11]=t("svg",{class:"w-16 h-16 mx-auto mb-4 text-light-300 dark:text-light-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e[12]||(e[12]=t("p",{class:"text-lg font-medium text-light-700 dark:text-light-300 mb-1"},"No traces found",-1)),t("p",ne,[e[10]||(e[10]=N("No traces found for: ",-1)),t("span",de,a(d.value),1)])])])):d.value?u("",!0):(o(),l("div",ue,[e[17]||(e[17]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Available Trace Names"),t("p",{class:"text-xs text-light-500 mt-0.5"},"Click a trace name to view all related events")],-1)),B.value?(o(),l("div",ce,[...e[13]||(e[13]=[t("div",{class:"spinner mx-auto mb-3"},null,-1),t("p",{class:"text-sm text-light-500"},"Loading trace names...",-1)])])):M.value?(o(),l("div",xe,[t("p",ve,[e[14]||(e[14]=t("strong",null,"Error:",-1)),N(" "+a(M.value),1)])])):y.value.length===0?(o(),l("div",he,[...e[15]||(e[15]=[t("svg",{class:"w-12 h-12 mx-auto mb-3 text-light-300 dark:text-light-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),t("p",{class:"text-sm text-light-500"},"No traces found yet",-1),t("p",{class:"text-xs text-light-400 mt-1"},"Traces will appear here once messages are processed with trace names",-1)])])):(o(),l("div",pe,[t("table",ge,[e[16]||(e[16]=t("thead",null,[t("tr",{class:"border-b border-light-200 dark:border-dark-100"},[t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Trace Name"),t("th",{class:"px-4 py-3 text-right text-xs font-semibold text-light-500 uppercase tracking-wider"},"Traces"),t("th",{class:"px-4 py-3 text-right text-xs font-semibold text-light-500 uppercase tracking-wider"},"Messages"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-light-500 uppercase tracking-wider"},"Last Seen")])],-1)),t("tbody",_e,[(o(!0),l(C,null,T(y.value,s=>(o(),l("tr",{key:s.trace_name,onClick:E=>W(s.trace_name),class:"hover:bg-light-50 dark:hover:bg-dark-200 cursor-pointer transition-colors"},[t("td",me,[t("span",be,a(s.trace_name),1)]),t("td",fe,[t("span",ye,a(s.trace_count),1)]),t("td",we,[t("span",Ce,a(s.message_count),1)]),t("td",Te,[t("span",Ne,a(P(s.last_seen)),1)])],8,ke))),128))])]),b.value>m.value?(o(),l("div",Me,[t("p",De," Showing "+a(p.value+1)+"-"+a(Math.min(p.value+m.value,b.value))+" of "+a(b.value),1),t("div",Ee,[t("button",{onClick:R,disabled:p.value===0,class:"btn btn-secondary text-sm"}," Previous ",8,je),t("button",{onClick:X,disabled:p.value+m.value>=b.value,class:"btn btn-secondary text-sm"}," Next ",8,qe)])])):u("",!0)]))])),i.value?(o(),l("div",{key:6,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-dark-500/50 backdrop-blur-sm",onClick:e[3]||(e[3]=at(s=>i.value=null,["self"]))},[t("div",Be,[t("div",Se,[t("div",Pe,[t("span",{class:q(["w-3 h-3 rounded-full",I(i.value.event_type)])},null,2),t("h3",Ve,a(i.value.event_type)+" Trace ",1)]),t("button",{onClick:e[1]||(e[1]=s=>i.value=null),class:"p-1 hover:bg-light-100 dark:hover:bg-dark-200 rounded-lg transition-colors"},[...e[18]||(e[18]=[t("svg",{class:"w-5 h-5 text-light-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",$e,[t("div",Ue,[t("div",null,[e[19]||(e[19]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Time",-1)),t("p",ze,a(P(i.value.created_at)),1)]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Queue",-1)),t("p",Ie,a(i.value.queue_name||"-"),1)]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Partition",-1)),t("p",Le,a(i.value.partition_name||"-"),1)]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Transaction ID",-1)),t("p",Ae,a(i.value.transaction_id),1)]),i.value.worker_id?(o(),l("div",Oe,[e[23]||(e[23]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Worker ID",-1)),t("p",Qe,a(i.value.worker_id),1)])):u("",!0),i.value.consumer_group&&i.value.consumer_group!=="__QUEUE_MODE__"?(o(),l("div",Fe,[e[24]||(e[24]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider"},"Consumer Group",-1)),t("p",He,a(i.value.consumer_group),1)])):u("",!0)]),((A=i.value.trace_names)==null?void 0:A.length)>0?(o(),l("div",Je,[e[25]||(e[25]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider block mb-2"},"Trace Names",-1)),t("div",Ke,[(o(!0),l(C,null,T(i.value.trace_names,s=>(o(),l("span",{key:s,class:q(["badge",s===d.value?"badge-queen":"badge-secondary"])},a(s),3))),128))])])):u("",!0),i.value.data?(o(),l("div",Ge,[e[26]||(e[26]=t("label",{class:"text-xs text-light-500 uppercase tracking-wider block mb-2"},"Trace Data",-1)),i.value.data.text?(o(),l("div",We,[t("p",Re,a(i.value.data.text),1)])):u("",!0),L(i.value.data)?(o(),l("div",Xe,[t("pre",Ye,a(Y(i.value.data)),1)])):u("",!0)])):u("",!0),t("div",Ze,[lt(n,{to:`/messages?partitionId=${i.value.partition_id}&transactionId=${i.value.transaction_id}`,class:"btn btn-secondary w-full text-sm",onClick:e[2]||(e[2]=s=>i.value=null)},{default:ot(()=>[...e[27]||(e[27]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1),N(" View Full Message ",-1)])]),_:1},8,["to"])])])])])):u("",!0)])}}};export{ls as default};
