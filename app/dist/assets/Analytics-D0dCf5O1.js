import{g as m,c as N,w as ye,k as _e,a as n,b as t,d as h,F as _,i as D,n as ne,A as S,B as ue,C as j,t as r,H as we,e as R,u as C,y as De,v as Se,s as ce,o as d}from"./index-Bh6pUXf_.js";import{f as L}from"./useApi-CMkbhU7m.js";import{u as Ce}from"./useRefresh-DGHeVgd7.js";import{_ as V}from"./BaseChart-DXKMvTEU.js";const Le={class:"space-y-4 sm:space-y-6 animate-fade-in"},Me={class:"card p-4"},Ae={class:"flex flex-col gap-4"},Te={class:"flex flex-wrap items-center gap-3"},He={class:"flex items-center gap-1 flex-wrap"},Fe=["onClick"],Pe={key:0,class:"flex flex-wrap items-center gap-3 pt-3 border-t border-light-200 dark:border-dark-50"},Qe={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-2"},je={class:"flex flex-wrap items-end gap-3"},Re={class:"w-48"},Ve=["value"],Be={class:"w-40"},Ue=["value"],$e={class:"w-40"},qe=["value"],ze={key:0,class:"flex flex-wrap gap-2 mt-3 pt-3 border-t border-light-200 dark:border-dark-50"},Ee={key:0,class:"badge badge-queen"},Oe={key:1,class:"badge badge-cyber"},We={key:2,class:"badge badge-crown"},Ie={key:0,class:"space-y-4 sm:space-y-6"},Je={class:"card"},Ye={class:"card-body"},Ze={key:1,class:"text-center py-12 text-light-500"},Ge={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6"},Ke={class:"card"},Xe={class:"card-body"},et={key:1,class:"text-center py-12 text-light-500"},tt={class:"card"},st={class:"card-body flex items-center justify-center"},at={key:1,class:"text-center py-12 text-light-500"},lt={class:"card"},ot={class:"card-body"},it={class:"grid grid-cols-2 md:grid-cols-5 gap-2 sm:gap-4"},dt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},rt={class:"text-2xl font-bold text-cyber-600 dark:text-cyber-400 mt-1"},nt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},ut={class:"text-2xl font-bold text-crown-600 dark:text-crown-400 mt-1"},ct={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},gt={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},pt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},vt={class:"text-2xl font-bold text-orange-600 dark:text-orange-400 mt-1"},mt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},ht={class:"text-2xl font-bold text-rose-600 dark:text-rose-400 mt-1"},xt={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6"},bt={class:"card"},kt={class:"card-body space-y-3"},ft={class:"flex items-center justify-between"},yt={class:"font-semibold"},_t={class:"flex items-center justify-between"},wt={class:"font-semibold"},Dt={class:"flex items-center justify-between"},St={class:"font-semibold"},Ct={class:"flex items-center justify-between"},Lt={class:"font-semibold"},Mt={class:"card"},At={class:"card-body space-y-3"},Tt={class:"flex items-center justify-between"},Ht={class:"font-semibold"},Ft={class:"flex items-center justify-between"},Pt={class:"font-semibold"},Qt={key:0,class:"pt-3 border-t border-light-200 dark:border-dark-50"},Nt={class:"space-y-2"},jt={class:"text-light-600 dark:text-light-400 truncate flex-1"},Rt={class:"font-semibold ml-2"},Vt={key:0,class:"card"},Bt={class:"card-header flex items-center justify-between"},Ut={class:"font-semibold text-light-900 dark:text-white"},$t={class:"card-body"},qt={class:"grid grid-cols-3 gap-2 sm:gap-4"},zt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},Et={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Ot={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},Wt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},It={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},Jt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},es={__name:"Analytics",setup(Yt){const Q=m(!0),i=m(null),M=m([]),B=m([]),U=m([]),A=m("1h"),x=m(!1),k=m(""),f=m(""),v=m(""),g=m(""),p=m(""),ge=[{label:"1h",value:"1h"},{label:"6h",value:"6h"},{label:"24h",value:"24h"},{label:"7d",value:"7d"}],$=s=>{const e=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0"),u=String(s.getHours()).padStart(2,"0"),c=String(s.getMinutes()).padStart(2,"0");return`${e}-${o}-${a}T${u}:${c}`},pe={plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20}}},scales:{y:{title:{display:!0,text:"Messages",font:{size:11}}}}},ve={plugins:{legend:{display:!1}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Messages",font:{size:11}}}}},me={plugins:{legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,padding:16}}},cutout:"60%"},he=(s,e)=>e?s.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),q=N(()=>{var a;if(!((a=i.value)!=null&&a.throughput)||!Array.isArray(i.value.throughput))return{labels:[],datasets:[]};const s=[...i.value.throughput].reverse();let e=!1;if(s.length>1){const u=new Date(s[0].timestamp),c=new Date(s[s.length-1].timestamp);e=u.toDateString()!==c.toDateString()}return{labels:s.map(u=>{const c=new Date(u.timestamp);return he(c,e)}),datasets:[{label:"Ingested",data:s.map(u=>u.ingested||0),fill:!0},{label:"Processed",data:s.map(u=>u.processed||0),fill:!0}]}}),z=N(()=>{if(!M.value.length)return{labels:[],datasets:[]};let s=[...M.value];v.value&&(s=s.filter(o=>o.name===v.value)),g.value&&(s=s.filter(o=>o.namespace===g.value)),p.value&&(s=s.filter(o=>o.task===p.value));const e=s.sort((o,a)=>{var u,c;return(((u=a.messages)==null?void 0:u.total)||0)-(((c=o.messages)==null?void 0:c.total)||0)}).slice(0,8);return{labels:e.map(o=>o.name.length>25?o.name.substring(0,25)+"...":o.name),datasets:[{label:"Pending",data:e.map(o=>{var a;return((a=o.messages)==null?void 0:a.pending)||0}),backgroundColor:"rgba(6, 182, 212, 0.7)"},{label:"Processing",data:e.map(o=>{var a;return((a=o.messages)==null?void 0:a.processing)||0}),backgroundColor:"rgba(245, 158, 11, 0.7)"},{label:"Completed",data:e.map(o=>{var a;return((a=o.messages)==null?void 0:a.completed)||0}),backgroundColor:"rgba(16, 185, 129, 0.7)"}]}}),E=N(()=>{var o;if(!((o=i.value)!=null&&o.messages))return{labels:[],datasets:[]};const s=i.value.messages,e=[{label:"Pending",value:s.pending||0,color:"rgba(6, 182, 212, 0.8)"},{label:"Processing",value:s.processing||0,color:"rgba(245, 158, 11, 0.8)"},{label:"Completed",value:s.completed||0,color:"rgba(16, 185, 129, 0.8)"},{label:"Failed",value:s.failed||0,color:"rgba(249, 115, 22, 0.8)"},{label:"Dead Letter",value:s.deadLetter||0,color:"rgba(244, 63, 94, 0.8)"}].filter(a=>a.value>0);return e.length===0?{labels:[],datasets:[]}:{labels:e.map(a=>a.label),datasets:[{data:e.map(a=>a.value),backgroundColor:e.map(a=>a.color),borderWidth:0}]}}),xe=s=>{x.value=!1,A.value=s,y()},be=()=>{if(x.value=!x.value,x.value){const s=new Date,e=new Date(s);switch(A.value){case"1h":e.setHours(e.getHours()-1);break;case"6h":e.setHours(e.getHours()-6);break;case"24h":e.setHours(e.getHours()-24);break;case"7d":e.setDate(e.getDate()-7);break}f.value=$(s),k.value=$(e)}},ke=()=>{if(!k.value||!f.value)return;const s=new Date(k.value),e=new Date(f.value);s>=e||y()},y=async()=>{var s,e,o;i.value||(Q.value=!0);try{let a,u;if(x.value&&k.value&&f.value)a=new Date(k.value),u=new Date(f.value);else{const w=new Date;switch(a=new Date(w),A.value){case"1h":a.setHours(a.getHours()-1);break;case"6h":a.setHours(a.getHours()-6);break;case"24h":a.setHours(a.getHours()-24);break;case"7d":a.setDate(a.getDate()-7);break}u=w}const c={from:a.toISOString(),to:u.toISOString()};v.value&&(c.queue=v.value),g.value&&(c.namespace=g.value),p.value&&(c.task=p.value);const[T,H,F,P]=await Promise.all([De.getStatus(c),Se.list({namespace:g.value,task:p.value}),ce.getNamespaces(),ce.getTasks()]);i.value=T.data,M.value=((s=H.data)==null?void 0:s.queues)||[],B.value=((e=F.data)==null?void 0:e.namespaces)||[],U.value=((o=P.data)==null?void 0:o.tasks)||[]}catch(a){console.error("Failed to fetch analytics:",a)}finally{Q.value=!1}},fe=()=>{v.value="",g.value="",p.value="",y()};return ye([v,g,p],()=>{y()}),Ce(y),_e(y),(s,e)=>{var o,a,u,c,T,H,F,P,w,O,W,I,J,Y,Z,G,K,X,ee,te,se,ae,le,oe,ie,de,re;return d(),n("div",Le,[t("div",Me,[t("div",Ae,[t("div",Te,[e[5]||(e[5]=t("label",{class:"text-xs font-medium text-light-600 dark:text-light-400"},"Time Range:",-1)),t("div",He,[(d(),n(_,null,D(ge,l=>t("button",{key:l.value,onClick:b=>xe(l.value),class:ne(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",A.value===l.value&&!x.value?"bg-queen-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])},r(l.label),11,Fe)),64)),t("button",{onClick:be,class:ne(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",x.value?"bg-queen-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])}," Custom ",2)])]),x.value?(d(),n("div",Pe,[t("div",Qe,[e[6]||(e[6]=t("label",{class:"text-xs font-medium text-light-600 dark:text-light-400 whitespace-nowrap"},"From:",-1)),S(t("input",{type:"datetime-local","onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),class:"input text-sm py-1.5 px-2 font-mono"},null,512),[[ue,k.value]])]),t("div",Ne,[e[7]||(e[7]=t("label",{class:"text-xs font-medium text-light-600 dark:text-light-400 whitespace-nowrap"},"To:",-1)),S(t("input",{type:"datetime-local","onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),class:"input text-sm py-1.5 px-2 font-mono"},null,512),[[ue,f.value]])]),t("button",{onClick:ke,class:"btn btn-primary text-xs"}," Apply ")])):h("",!0),t("div",je,[t("div",Re,[e[9]||(e[9]=t("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Queue",-1)),S(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l),class:"select"},[e[8]||(e[8]=t("option",{value:""},"All Queues",-1)),(d(!0),n(_,null,D(M.value,l=>(d(),n("option",{key:l.name,value:l.name},r(l.name),9,Ve))),128))],512),[[j,v.value]])]),t("div",Be,[e[11]||(e[11]=t("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Namespace",-1)),S(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),class:"select"},[e[10]||(e[10]=t("option",{value:""},"All Namespaces",-1)),(d(!0),n(_,null,D(B.value,l=>(d(),n("option",{key:l.namespace,value:l.namespace},r(l.namespace||"Default"),9,Ue))),128))],512),[[j,g.value]])]),t("div",$e,[e[13]||(e[13]=t("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Task",-1)),S(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),class:"select"},[e[12]||(e[12]=t("option",{value:""},"All Tasks",-1)),(d(!0),n(_,null,D(U.value,l=>(d(),n("option",{key:l.task,value:l.task},r(l.task||"Default"),9,qe))),128))],512),[[j,p.value]])]),v.value||g.value||p.value?(d(),n("button",{key:0,onClick:fe,class:"btn btn-ghost text-xs"}," Clear Filters ")):h("",!0)])]),v.value||g.value||p.value?(d(),n("div",ze,[v.value?(d(),n("span",Ee," Queue: "+r(v.value),1)):h("",!0),g.value?(d(),n("span",Oe," Namespace: "+r(g.value),1)):h("",!0),p.value?(d(),n("span",We," Task: "+r(p.value),1)):h("",!0)])):h("",!0)]),Q.value?(d(),n("div",Ie,[...e[14]||(e[14]=[we('<div class="card p-6"><div class="skeleton h-64 w-full rounded-lg"></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6"><div class="card p-6"><div class="skeleton h-48 w-full rounded-lg"></div></div><div class="card p-6"><div class="skeleton h-48 w-full rounded-lg"></div></div></div>',2)])])):i.value?(d(),n(_,{key:1},[t("div",Je,[e[15]||(e[15]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Flow Over Time")],-1)),t("div",Ye,[q.value.labels.length>0?(d(),R(V,{key:0,type:"line",data:q.value,options:pe,height:"280px"},null,8,["data"])):(d(),n("div",Ze," No throughput data available "))])]),t("div",Ge,[t("div",Ke,[e[16]||(e[16]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Top Queues by Volume")],-1)),t("div",Xe,[z.value.labels.length>0?(d(),R(V,{key:0,type:"bar",data:z.value,options:ve,height:"240px"},null,8,["data"])):(d(),n("div",et," No queue data available "))])]),t("div",tt,[e[17]||(e[17]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Status Distribution")],-1)),t("div",st,[E.value.labels.length>0?(d(),R(V,{key:0,type:"doughnut",data:E.value,options:me,height:"240px"},null,8,["data"])):(d(),n("div",at," No message data available "))])])]),t("div",lt,[e[23]||(e[23]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Counts")],-1)),t("div",ot,[t("div",it,[t("div",dt,[e[18]||(e[18]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Pending",-1)),t("p",rt,r(C(L)(((a=(o=i.value)==null?void 0:o.messages)==null?void 0:a.pending)||0)),1)]),t("div",nt,[e[19]||(e[19]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Processing",-1)),t("p",ut,r(C(L)(((c=(u=i.value)==null?void 0:u.messages)==null?void 0:c.processing)||0)),1)]),t("div",ct,[e[20]||(e[20]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Completed",-1)),t("p",gt,r(C(L)(((H=(T=i.value)==null?void 0:T.messages)==null?void 0:H.completed)||0)),1)]),t("div",pt,[e[21]||(e[21]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Failed",-1)),t("p",vt,r(C(L)(((P=(F=i.value)==null?void 0:F.messages)==null?void 0:P.failed)||0)),1)]),t("div",mt,[e[22]||(e[22]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Dead Letter",-1)),t("p",ht,r(C(L)(((O=(w=i.value)==null?void 0:w.messages)==null?void 0:O.deadLetter)||0)),1)])])])]),t("div",xt,[t("div",bt,[e[28]||(e[28]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Active Leases")],-1)),t("div",kt,[t("div",ft,[e[24]||(e[24]=t("span",{class:"text-light-600 dark:text-light-400"},"Active Leases",-1)),t("span",yt,r(((I=(W=i.value)==null?void 0:W.leases)==null?void 0:I.active)||0),1)]),t("div",_t,[e[25]||(e[25]=t("span",{class:"text-light-600 dark:text-light-400"},"Partitions with Leases",-1)),t("span",wt,r(((Y=(J=i.value)==null?void 0:J.leases)==null?void 0:Y.partitionsWithLeases)||0),1)]),t("div",Dt,[e[26]||(e[26]=t("span",{class:"text-light-600 dark:text-light-400"},"Total Batch Size",-1)),t("span",St,r(((G=(Z=i.value)==null?void 0:Z.leases)==null?void 0:G.totalBatchSize)||0),1)]),t("div",Ct,[e[27]||(e[27]=t("span",{class:"text-light-600 dark:text-light-400"},"Total Acked",-1)),t("span",Lt,r(((X=(K=i.value)==null?void 0:K.leases)==null?void 0:X.totalAcked)||0),1)])])]),t("div",Mt,[e[32]||(e[32]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Dead Letter Queue")],-1)),t("div",At,[t("div",Tt,[e[29]||(e[29]=t("span",{class:"text-light-600 dark:text-light-400"},"Total Messages",-1)),t("span",Ht,r(((te=(ee=i.value)==null?void 0:ee.deadLetterQueue)==null?void 0:te.totalMessages)||0),1)]),t("div",Ft,[e[30]||(e[30]=t("span",{class:"text-light-600 dark:text-light-400"},"Affected Partitions",-1)),t("span",Pt,r(((ae=(se=i.value)==null?void 0:se.deadLetterQueue)==null?void 0:ae.affectedPartitions)||0),1)]),(ie=(oe=(le=i.value)==null?void 0:le.deadLetterQueue)==null?void 0:oe.topErrors)!=null&&ie.length?(d(),n("div",Qt,[e[31]||(e[31]=t("p",{class:"text-xs font-semibold text-light-600 dark:text-light-400 mb-2"},"Top Errors:",-1)),t("div",Nt,[(d(!0),n(_,null,D(i.value.deadLetterQueue.topErrors.slice(0,3),(l,b)=>(d(),n("div",{key:b,class:"flex items-center justify-between text-sm"},[t("span",jt,r(l.error),1),t("span",Rt,r(l.count),1)]))),128))])])):h("",!0)])])]),(re=(de=i.value)==null?void 0:de.workers)!=null&&re.length?(d(),n("div",Vt,[t("div",Bt,[t("h3",Ut,r(i.value.workers.length)+" Workers",1),e[33]||(e[33]=t("span",{class:"badge badge-success"},"Healthy",-1))]),t("div",$t,[t("div",qt,[t("div",zt,[e[34]||(e[34]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Avg Event Loop",-1)),t("p",Et,r(Math.round(i.value.workers.reduce((l,b)=>l+(b.avgEventLoopLagMs||0),0)/i.value.workers.length))+"ms ",1)]),t("div",Ot,[e[35]||(e[35]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Connection Pool",-1)),t("p",Wt,r(i.value.workers.reduce((l,b)=>l+(b.freeSlots||0),0))+"/"+r(i.value.workers.reduce((l,b)=>l+(b.dbConnections||0),0)),1)]),t("div",It,[e[36]||(e[36]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Max Job Queue",-1)),t("p",Jt,r(Math.max(...i.value.workers.map(l=>l.jobQueueSize||0))),1)])])])])):h("",!0)],64)):h("",!0)])}}};export{es as default};
