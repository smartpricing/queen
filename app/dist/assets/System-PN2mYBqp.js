import{h as D,c as p,l as W,a as h,b as t,d as I,n as M,F as S,j as O,t as _,e as x,M as Q,o}from"./index-DukDhp_y.js";import{_ as y}from"./BaseChart-7Qv702xa.js";const Z={class:"space-y-6 animate-fade-in"},G={class:"card p-4"},H={class:"flex flex-wrap items-center gap-4"},J={class:"flex items-center gap-2"},K={class:"flex items-center gap-1"},X={class:"flex items-center gap-2"},Y={class:"flex items-center gap-1"},tt=["onClick"],et={key:0,class:"space-y-6"},at={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},st={class:"card"},lt={class:"card-header flex items-center justify-between"},it={class:"text-xs text-light-500"},ot={class:"card-body"},rt={key:1,class:"text-center py-12 text-light-500"},dt={class:"card"},nt={class:"card-body"},ct={key:1,class:"text-center py-12 text-light-500"},ut={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},gt={class:"card"},ht={class:"card-body"},mt={key:1,class:"text-center py-12 text-light-500"},pt={class:"card"},vt={class:"card-body"},bt={key:1,class:"text-center py-12 text-light-500"},xt={class:"card"},yt={class:"card-header flex items-center justify-between"},_t={key:0,class:"badge badge-danger"},kt={class:"card-body"},ft={key:1,class:"text-center py-12 text-light-500"},Dt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},wt={class:"card"},St={class:"card-header flex items-center justify-between"},Ct={class:"text-xs text-light-500"},Lt={class:"card-body"},Mt={key:1,class:"text-center py-12 text-light-500"},Pt={class:"card"},Nt={class:"card-body"},Ut={key:1,class:"text-center py-12 text-light-500"},Bt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Et={class:"card"},Ft={class:"card-body"},Rt={key:1,class:"text-center py-12 text-light-500"},qt={class:"card"},jt={class:"card-body"},zt={key:1,class:"text-center py-12 text-light-500"},At={class:"card"},It={class:"card-body"},Ot={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Qt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Tt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},$t={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Vt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Wt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Zt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Gt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Ht={class:"text-2xl font-bold text-rose-600 dark:text-rose-400 mt-1"},Yt={__name:"System",setup(Jt){const C=D(!0),k=D("worker"),L=D(60),m=D(null),g=D(null),T=[{label:"15m",value:15},{label:"1h",value:60},{label:"6h",value:360},{label:"24h",value:1440}],P={plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:16}}}},v=(e,a)=>a?e.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),b=e=>{if(!e||e.length<2)return!1;const a=new Date(e[0].timestamp),d=new Date(e[e.length-1].timestamp);return a.toDateString()!==d.toDateString()},$=p(()=>{var a,d,l,i;if(!((d=(a=g.value)==null?void 0:a.replicas)!=null&&d.length))return null;const e=g.value.replicas[0];return(l=e==null?void 0:e.timeSeries)!=null&&l.length?(i=e.timeSeries[e.timeSeries.length-1])==null?void 0:i.metrics:null}),N=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.timeSeries)!=null&&a.length?m.value.timeSeries.reduce((d,l)=>d+(l.dbErrors||0)+(l.ackFailed||0)+(l.dlqCount||0),0):0}),U=p(()=>{var l,i;if(!((i=(l=m.value)==null?void 0:l.timeSeries)!=null&&i.length))return{labels:[],datasets:[]};const e=m.value.timeSeries,a=b(e);return{labels:e.map(s=>v(new Date(s.timestamp),a)),datasets:[{label:"Ingested",data:e.map(s=>s.ingested||0),fill:!0},{label:"Processed",data:e.map(s=>s.processed||0),fill:!0}]}}),B=p(()=>{var l,i;if(!((i=(l=m.value)==null?void 0:l.timeSeries)!=null&&i.length))return{labels:[],datasets:[]};const e=m.value.timeSeries,a=b(e);return{labels:e.map(s=>v(new Date(s.timestamp),a)),datasets:[{label:"Avg Lag (ms)",data:e.map(s=>s.avgLagMs||0),fill:!1},{label:"Max Lag (ms)",data:e.map(s=>s.maxLagMs||0),fill:!1}]}}),E=p(()=>{var l,i;if(!((i=(l=m.value)==null?void 0:l.timeSeries)!=null&&i.length))return{labels:[],datasets:[]};const e=m.value.timeSeries,a=b(e);return{labels:e.map(s=>v(new Date(s.timestamp),a)),datasets:[{label:"Event Loop (ms)",data:e.map(s=>s.avgEventLoopLagMs||0),fill:!0}]}}),F=p(()=>{var l,i;if(!((i=(l=m.value)==null?void 0:l.timeSeries)!=null&&i.length))return{labels:[],datasets:[]};const e=m.value.timeSeries,a=b(e);return{labels:e.map(s=>v(new Date(s.timestamp),a)),datasets:[{label:"Free Slots",data:e.map(s=>s.freeSlots||0),fill:!0},{label:"DB Connections",data:e.map(s=>s.dbConnections||0),fill:!1}]}}),R=p(()=>{var l,i;if(!((i=(l=m.value)==null?void 0:l.timeSeries)!=null&&i.length))return{labels:[],datasets:[]};const e=m.value.timeSeries,a=b(e);return{labels:e.map(s=>v(new Date(s.timestamp),a)),datasets:[{label:"DB Errors",data:e.map(s=>s.dbErrors||0),backgroundColor:"rgba(244, 63, 94, 0.7)"},{label:"Ack Failed",data:e.map(s=>s.ackFailed||0),backgroundColor:"rgba(245, 158, 11, 0.7)"},{label:"DLQ",data:e.map(s=>s.dlqCount||0),backgroundColor:"rgba(139, 92, 246, 0.7)"}]}}),q=p(()=>{var l,i,s;if(!((i=(l=g.value)==null?void 0:l.replicas)!=null&&i.length))return{labels:[],datasets:[]};const e=((s=g.value.replicas[0])==null?void 0:s.timeSeries)||[],a=b(e);return{labels:e.map(r=>v(new Date(r.timestamp),a)),datasets:[{label:"User CPU (%)",data:e.map(r=>{var n,c,u;return(((u=(c=(n=r.metrics)==null?void 0:n.cpu)==null?void 0:c.user_us)==null?void 0:u.avg)||0)/100}),fill:!0},{label:"System CPU (%)",data:e.map(r=>{var n,c,u;return(((u=(c=(n=r.metrics)==null?void 0:n.cpu)==null?void 0:c.system_us)==null?void 0:u.avg)||0)/100}),fill:!0}]}}),j=p(()=>{var l,i,s;if(!((i=(l=g.value)==null?void 0:l.replicas)!=null&&i.length))return{labels:[],datasets:[]};const e=((s=g.value.replicas[0])==null?void 0:s.timeSeries)||[],a=b(e);return{labels:e.map(r=>v(new Date(r.timestamp),a)),datasets:[{label:"RSS (MB)",data:e.map(r=>{var n,c,u;return Math.round((((u=(c=(n=r.metrics)==null?void 0:n.memory)==null?void 0:c.rss_bytes)==null?void 0:u.avg)||0)/1024/1024)}),fill:!0}]}}),z=p(()=>{var l,i,s;if(!((i=(l=g.value)==null?void 0:l.replicas)!=null&&i.length))return{labels:[],datasets:[]};const e=((s=g.value.replicas[0])==null?void 0:s.timeSeries)||[],a=b(e);return{labels:e.map(r=>v(new Date(r.timestamp),a)),datasets:[{label:"Active",data:e.map(r=>{var n,c,u;return((u=(c=(n=r.metrics)==null?void 0:n.database)==null?void 0:c.pool_active)==null?void 0:u.avg)||0}),fill:!0},{label:"Idle",data:e.map(r=>{var n,c,u;return((u=(c=(n=r.metrics)==null?void 0:n.database)==null?void 0:c.pool_idle)==null?void 0:u.avg)||0}),fill:!0}]}}),A=p(()=>{var l,i,s;if(!((i=(l=g.value)==null?void 0:l.replicas)!=null&&i.length))return{labels:[],datasets:[]};const e=((s=g.value.replicas[0])==null?void 0:s.timeSeries)||[],a=b(e);return{labels:e.map(r=>v(new Date(r.timestamp),a)),datasets:[{label:"DB Queue",data:e.map(r=>{var n,c,u,f;return((f=(u=(c=(n=r.metrics)==null?void 0:n.threadpool)==null?void 0:c.db)==null?void 0:u.queue_size)==null?void 0:f.avg)||0}),fill:!0},{label:"System Queue",data:e.map(r=>{var n,c,u,f;return((f=(u=(c=(n=r.metrics)==null?void 0:n.threadpool)==null?void 0:c.system)==null?void 0:u.queue_size)==null?void 0:f.avg)||0}),fill:!0}]}}),V=e=>e==null?"0%":(e/100).toFixed(1)+"%",w=async()=>{C.value=!0;try{const e=new Date,d={from:new Date(e.getTime()-L.value*60*1e3).toISOString(),to:e.toISOString()},[l,i]=await Promise.all([Q.getWorkerMetrics(d),Q.getSystemMetrics(d)]);m.value=l.data,g.value=i.data}catch(e){console.error("Failed to fetch system metrics:",e)}finally{C.value=!1}};return W(w),(e,a)=>{var d,l,i;return o(),h("div",Z,[t("div",G,[t("div",H,[t("div",J,[a[2]||(a[2]=t("span",{class:"text-xs font-medium text-light-500"},"Source:",-1)),t("div",K,[t("button",{onClick:a[0]||(a[0]=s=>{k.value="worker",w()}),class:M(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",k.value==="worker"?"bg-queen-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])}," Queue Operations ",2),t("button",{onClick:a[1]||(a[1]=s=>{k.value="system",w()}),class:M(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",k.value==="system"?"bg-queen-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])}," System Resources ",2)])]),t("div",X,[a[3]||(a[3]=t("span",{class:"text-xs font-medium text-light-500"},"Range:",-1)),t("div",Y,[(o(),h(S,null,O(T,s=>t("button",{key:s.value,onClick:r=>{L.value=s.value,w()},class:M(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",L.value===s.value?"bg-cyber-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])},_(s.label),11,tt)),64))])])])]),C.value?(o(),h("div",et,[t("div",at,[(o(),h(S,null,O(4,s=>t("div",{key:s,class:"card p-6"},[...a[4]||(a[4]=[t("div",{class:"skeleton h-48 w-full rounded-lg"},null,-1)])])),64))])])):k.value==="worker"&&m.value?(o(),h(S,{key:1},[t("div",st,[t("div",lt,[a[5]||(a[5]=t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Throughput",-1)),t("span",it,_(m.value.pointCount||0)+" data points",1)]),t("div",ot,[U.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:U.value,options:P,height:"280px"},null,8,["data"])):(o(),h("div",rt," No throughput data available "))])]),t("div",dt,[a[6]||(a[6]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Latency")],-1)),t("div",nt,[B.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:B.value,options:P,height:"240px"},null,8,["data"])):(o(),h("div",ct," No latency data available "))])]),t("div",ut,[t("div",gt,[a[7]||(a[7]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Event Loop Latency")],-1)),t("div",ht,[E.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:E.value,height:"200px"},null,8,["data"])):(o(),h("div",mt," No event loop data available "))])]),t("div",pt,[a[8]||(a[8]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Connection Pool")],-1)),t("div",vt,[F.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:F.value,height:"200px"},null,8,["data"])):(o(),h("div",bt," No connection pool data available "))])])]),t("div",xt,[t("div",yt,[a[9]||(a[9]=t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Errors",-1)),N.value>0?(o(),h("span",_t,_(N.value)+" in period",1)):I("",!0)]),t("div",kt,[R.value.labels.length>0?(o(),x(y,{key:0,type:"bar",data:R.value,options:{scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}},height:"200px"},null,8,["data"])):(o(),h("div",ft," No error data available "))])])],64)):k.value==="system"&&g.value?(o(),h(S,{key:2},[t("div",Dt,[t("div",wt,[t("div",St,[a[10]||(a[10]=t("h3",{class:"font-semibold text-light-900 dark:text-white"},"CPU Usage",-1)),t("span",Ct,_(g.value.replicaCount||0)+" replicas",1)]),t("div",Lt,[q.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:q.value,height:"240px"},null,8,["data"])):(o(),h("div",Mt," No CPU data available "))])]),t("div",Pt,[a[11]||(a[11]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Memory Usage")],-1)),t("div",Nt,[j.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:j.value,height:"240px"},null,8,["data"])):(o(),h("div",Ut," No memory data available "))])])]),t("div",Bt,[t("div",Et,[a[12]||(a[12]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Database Pool")],-1)),t("div",Ft,[z.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:z.value,height:"200px"},null,8,["data"])):(o(),h("div",Rt," No database pool data available "))])]),t("div",qt,[a[13]||(a[13]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"Thread Pool")],-1)),t("div",jt,[A.value.labels.length>0?(o(),x(y,{key:0,type:"line",data:A.value,height:"200px"},null,8,["data"])):(o(),h("div",zt," No thread pool data available "))])])]),t("div",At,[a[18]||(a[18]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold text-light-900 dark:text-white"},"System Summary")],-1)),t("div",It,[t("div",Ot,[t("div",Qt,[a[14]||(a[14]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Replicas",-1)),t("p",Tt,_(g.value.replicaCount||0),1)]),t("div",$t,[a[15]||(a[15]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Data Points",-1)),t("p",Vt,_(g.value.pointCount||0),1)]),t("div",Wt,[a[16]||(a[16]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Bucket Size",-1)),t("p",Zt,_(g.value.bucketMinutes||1)+"m ",1)]),t("div",Gt,[a[17]||(a[17]=t("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Latest CPU",-1)),t("p",Ht,_(V((i=(l=(d=$.value)==null?void 0:d.cpu)==null?void 0:l.user_us)==null?void 0:i.last)),1)])])])])],64)):I("",!0)])}}};export{Yt as default};
