import{h,c as M,l as ce,a as u,b as e,d as b,F as k,j as f,A as Q,C as T,t as o,J as ge,e as j,u as S,f as L,y as ve,v as pe,s as ae,o as i,n as he}from"./index-DukDhp_y.js";import{_ as N}from"./BaseChart-7Qv702xa.js";const be={class:"space-y-6 animate-fade-in"},me={class:"card p-4"},xe={class:"flex flex-wrap items-end gap-4"},ke={class:"flex-shrink-0"},fe={class:"flex items-center gap-1"},_e=["onClick"],ye={class:"w-48"},we=["value"],De={class:"w-40"},Ce=["value"],Se={class:"w-40"},Le=["value"],Ae={key:0,class:"flex flex-wrap gap-2 mt-3 pt-3 border-t border-light-200 dark:border-dark-50"},Pe={key:0,class:"badge badge-queen"},Me={key:1,class:"badge badge-cyber"},Qe={key:2,class:"badge badge-crown"},Te={key:0,class:"space-y-6"},je={class:"card"},Ne={class:"card-body"},Fe={key:1,class:"text-center py-12 text-light-500"},He={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Re={class:"card"},Ve={class:"card-body"},Be={key:1,class:"text-center py-12 text-light-500"},Ee={class:"card"},Oe={class:"card-body flex items-center justify-center"},qe={class:"card"},Ue={class:"card-body"},ze={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},We={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Ie={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},Je={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},$e={class:"text-2xl font-bold text-cyber-600 dark:text-cyber-400 mt-1"},Ze={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Ge={class:"text-2xl font-bold text-crown-600 dark:text-crown-400 mt-1"},Ke={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg"},Xe={class:"text-2xl font-bold text-rose-600 dark:text-rose-400 mt-1"},Ye={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},et={class:"card"},tt={class:"card-body space-y-3"},st={class:"flex items-center justify-between"},at={class:"font-semibold"},lt={class:"flex items-center justify-between"},ot={class:"font-semibold"},it={class:"flex items-center justify-between"},dt={class:"font-semibold"},rt={class:"flex items-center justify-between"},nt={class:"font-semibold"},ut={class:"card"},ct={class:"card-body space-y-3"},gt={class:"flex items-center justify-between"},vt={class:"font-semibold"},pt={class:"flex items-center justify-between"},ht={class:"font-semibold"},bt={key:0,class:"pt-3 border-t border-light-200 dark:border-dark-50"},mt={class:"space-y-2"},xt={class:"text-light-600 dark:text-light-400 truncate flex-1"},kt={class:"font-semibold ml-2"},ft={key:0,class:"card"},_t={class:"card-header flex items-center justify-between"},yt={class:"font-semibold text-light-900 dark:text-white"},wt={class:"card-body"},Dt={class:"grid grid-cols-3 gap-4"},Ct={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},St={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Lt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},At={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Pt={class:"p-4 bg-light-100 dark:bg-dark-300 rounded-lg text-center"},Mt={class:"text-2xl font-bold text-light-900 dark:text-light-100 mt-1"},Nt={__name:"Analytics",setup(Qt){const A=h(!0),a=h(null),_=h([]),F=h([]),H=h([]),P=h("1h"),p=h(""),g=h(""),v=h(""),le=[{label:"1h",value:"1h"},{label:"6h",value:"6h"},{label:"24h",value:"24h"},{label:"7d",value:"7d"}],oe={plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20}}}},ie={plugins:{legend:{display:!1}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}},de={plugins:{legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,padding:16}}},cutout:"60%"},re=(l,t)=>t?l.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),R=M(()=>{var n;if(!((n=a.value)!=null&&n.throughput)||!Array.isArray(a.value.throughput))return{labels:[],datasets:[]};const l=[...a.value.throughput].reverse();let t=!1;if(l.length>1){const d=new Date(l[0].timestamp),c=new Date(l[l.length-1].timestamp);t=d.toDateString()!==c.toDateString()}return{labels:l.map(d=>{const c=new Date(d.timestamp);return re(c,t)}),datasets:[{label:"Ingested",data:l.map(d=>d.ingested||0),fill:!0},{label:"Processed",data:l.map(d=>d.processed||0),fill:!0}]}}),V=M(()=>{if(!_.value.length)return{labels:[],datasets:[]};let l=[..._.value];g.value&&(l=l.filter(r=>r.namespace===g.value)),v.value&&(l=l.filter(r=>r.task===v.value));const t=l.sort((r,n)=>{var d,c;return(((d=n.messages)==null?void 0:d.total)||0)-(((c=r.messages)==null?void 0:c.total)||0)}).slice(0,8);return{labels:t.map(r=>r.name.length>25?r.name.substring(0,25)+"...":r.name),datasets:[{label:"Pending",data:t.map(r=>{var n;return((n=r.messages)==null?void 0:n.pending)||0}),backgroundColor:"rgba(6, 182, 212, 0.7)"},{label:"Processing",data:t.map(r=>{var n;return((n=r.messages)==null?void 0:n.processing)||0}),backgroundColor:"rgba(245, 158, 11, 0.7)"},{label:"Completed",data:t.map(r=>{var n;return((n=r.messages)==null?void 0:n.completed)||0}),backgroundColor:"rgba(16, 185, 129, 0.7)"}]}}),ne=M(()=>{var t;if(!((t=a.value)!=null&&t.messages))return{labels:[],datasets:[]};const l=a.value.messages;return{labels:["Pending","Processing","Completed","Dead Letter"],datasets:[{data:[l.pending||0,l.processing||0,l.completed||0,l.deadLetter||0],backgroundColor:["rgba(6, 182, 212, 0.8)","rgba(245, 158, 11, 0.8)","rgba(16, 185, 129, 0.8)","rgba(244, 63, 94, 0.8)"],borderWidth:0}]}}),x=async()=>{var l,t,r;A.value=!0;try{const n=new Date,d=new Date(n);switch(P.value){case"1h":d.setHours(d.getHours()-1);break;case"6h":d.setHours(d.getHours()-6);break;case"24h":d.setHours(d.getHours()-24);break;case"7d":d.setDate(d.getDate()-7);break}const c={from:d.toISOString(),to:n.toISOString()};p.value&&(c.queue=p.value),g.value&&(c.namespace=g.value),v.value&&(c.task=v.value);const[y,w,D,C]=await Promise.all([ve.getStatus(c),pe.list(),ae.getNamespaces(),ae.getTasks()]);a.value=y.data,_.value=((l=w.data)==null?void 0:l.queues)||[],F.value=((t=D.data)==null?void 0:t.namespaces)||[],H.value=((r=C.data)==null?void 0:r.tasks)||[]}catch(n){console.error("Failed to fetch analytics:",n)}finally{A.value=!1}},ue=()=>{p.value="",g.value="",v.value="",x()};return ce(x),(l,t)=>{var r,n,d,c,y,w,D,C,B,E,O,q,U,z,W,I,J,$,Z,G,K,X,Y,ee,te,se;return i(),u("div",be,[e("div",me,[e("div",xe,[e("div",ke,[t[3]||(t[3]=e("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Time Range",-1)),e("div",fe,[(i(),u(k,null,f(le,s=>e("button",{key:s.value,onClick:m=>{P.value=s.value,x()},class:he(["px-3 py-1.5 text-xs font-medium rounded-lg transition-colors",P.value===s.value?"bg-queen-500 text-white":"bg-light-100 dark:bg-dark-300 text-light-700 dark:text-light-300 hover:bg-light-200 dark:hover:bg-dark-200"])},o(s.label),11,_e)),64))])]),e("div",ye,[t[5]||(t[5]=e("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Queue",-1)),Q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),onChange:x,class:"select"},[t[4]||(t[4]=e("option",{value:""},"All Queues",-1)),(i(!0),u(k,null,f(_.value,s=>(i(),u("option",{key:s.name,value:s.name},o(s.name),9,we))),128))],544),[[T,p.value]])]),e("div",De,[t[7]||(t[7]=e("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Namespace",-1)),Q(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),onChange:x,class:"select"},[t[6]||(t[6]=e("option",{value:""},"All Namespaces",-1)),(i(!0),u(k,null,f(F.value,s=>(i(),u("option",{key:s.namespace,value:s.namespace},o(s.namespace||"Default"),9,Ce))),128))],544),[[T,g.value]])]),e("div",Se,[t[9]||(t[9]=e("label",{class:"block text-xs font-medium text-light-600 dark:text-light-400 mb-1.5"},"Task",-1)),Q(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),onChange:x,class:"select"},[t[8]||(t[8]=e("option",{value:""},"All Tasks",-1)),(i(!0),u(k,null,f(H.value,s=>(i(),u("option",{key:s.task,value:s.task},o(s.task||"Default"),9,Le))),128))],544),[[T,v.value]])]),p.value||g.value||v.value?(i(),u("button",{key:0,onClick:ue,class:"btn btn-ghost text-xs"}," Clear Filters ")):b("",!0)]),p.value||g.value||v.value?(i(),u("div",Ae,[p.value?(i(),u("span",Pe," Queue: "+o(p.value),1)):b("",!0),g.value?(i(),u("span",Me," Namespace: "+o(g.value),1)):b("",!0),v.value?(i(),u("span",Qe," Task: "+o(v.value),1)):b("",!0)])):b("",!0)]),A.value?(i(),u("div",Te,[...t[10]||(t[10]=[ge('<div class="card p-6"><div class="skeleton h-64 w-full rounded-lg"></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="card p-6"><div class="skeleton h-48 w-full rounded-lg"></div></div><div class="card p-6"><div class="skeleton h-48 w-full rounded-lg"></div></div></div>',2)])])):a.value?(i(),u(k,{key:1},[e("div",je,[t[11]||(t[11]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Flow Over Time")],-1)),e("div",Ne,[R.value.labels.length>0?(i(),j(N,{key:0,type:"line",data:R.value,options:oe,height:"280px"},null,8,["data"])):(i(),u("div",Fe," No throughput data available "))])]),e("div",He,[e("div",Re,[t[12]||(t[12]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Top Queues by Volume")],-1)),e("div",Ve,[V.value.labels.length>0?(i(),j(N,{key:0,type:"bar",data:V.value,options:ie,height:"240px"},null,8,["data"])):(i(),u("div",Be," No queue data available "))])]),e("div",Ee,[t[13]||(t[13]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Message Status Distribution")],-1)),e("div",Oe,[(r=a.value)!=null&&r.messages?(i(),j(N,{key:0,type:"doughnut",data:ne.value,options:de,height:"240px"},null,8,["data"])):b("",!0)])])]),e("div",qe,[t[18]||(t[18]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Performance Metrics")],-1)),e("div",Ue,[e("div",ze,[e("div",We,[t[14]||(t[14]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Completed",-1)),e("p",Ie,o(S(L)(((d=(n=a.value)==null?void 0:n.messages)==null?void 0:d.completed)||0)),1)]),e("div",Je,[t[15]||(t[15]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Pending",-1)),e("p",$e,o(S(L)(((y=(c=a.value)==null?void 0:c.messages)==null?void 0:y.pending)||0)),1)]),e("div",Ze,[t[16]||(t[16]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Processing",-1)),e("p",Ge,o(S(L)(((D=(w=a.value)==null?void 0:w.messages)==null?void 0:D.processing)||0)),1)]),e("div",Ke,[t[17]||(t[17]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Dead Letter",-1)),e("p",Xe,o(S(L)(((B=(C=a.value)==null?void 0:C.messages)==null?void 0:B.deadLetter)||0)),1)])])])]),e("div",Ye,[e("div",et,[t[23]||(t[23]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Active Leases")],-1)),e("div",tt,[e("div",st,[t[19]||(t[19]=e("span",{class:"text-light-600 dark:text-light-400"},"Active Leases",-1)),e("span",at,o(((O=(E=a.value)==null?void 0:E.leases)==null?void 0:O.active)||0),1)]),e("div",lt,[t[20]||(t[20]=e("span",{class:"text-light-600 dark:text-light-400"},"Partitions with Leases",-1)),e("span",ot,o(((U=(q=a.value)==null?void 0:q.leases)==null?void 0:U.partitionsWithLeases)||0),1)]),e("div",it,[t[21]||(t[21]=e("span",{class:"text-light-600 dark:text-light-400"},"Total Batch Size",-1)),e("span",dt,o(((W=(z=a.value)==null?void 0:z.leases)==null?void 0:W.totalBatchSize)||0),1)]),e("div",rt,[t[22]||(t[22]=e("span",{class:"text-light-600 dark:text-light-400"},"Total Acked",-1)),e("span",nt,o(((J=(I=a.value)==null?void 0:I.leases)==null?void 0:J.totalAcked)||0),1)])])]),e("div",ut,[t[27]||(t[27]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold text-light-900 dark:text-white"},"Dead Letter Queue")],-1)),e("div",ct,[e("div",gt,[t[24]||(t[24]=e("span",{class:"text-light-600 dark:text-light-400"},"Total Messages",-1)),e("span",vt,o(((Z=($=a.value)==null?void 0:$.deadLetterQueue)==null?void 0:Z.totalMessages)||0),1)]),e("div",pt,[t[25]||(t[25]=e("span",{class:"text-light-600 dark:text-light-400"},"Affected Partitions",-1)),e("span",ht,o(((K=(G=a.value)==null?void 0:G.deadLetterQueue)==null?void 0:K.affectedPartitions)||0),1)]),(ee=(Y=(X=a.value)==null?void 0:X.deadLetterQueue)==null?void 0:Y.topErrors)!=null&&ee.length?(i(),u("div",bt,[t[26]||(t[26]=e("p",{class:"text-xs font-semibold text-light-600 dark:text-light-400 mb-2"},"Top Errors:",-1)),e("div",mt,[(i(!0),u(k,null,f(a.value.deadLetterQueue.topErrors.slice(0,3),(s,m)=>(i(),u("div",{key:m,class:"flex items-center justify-between text-sm"},[e("span",xt,o(s.error),1),e("span",kt,o(s.count),1)]))),128))])])):b("",!0)])])]),(se=(te=a.value)==null?void 0:te.workers)!=null&&se.length?(i(),u("div",ft,[e("div",_t,[e("h3",yt,o(a.value.workers.length)+" Workers",1),t[28]||(t[28]=e("span",{class:"badge badge-success"},"Healthy",-1))]),e("div",wt,[e("div",Dt,[e("div",Ct,[t[29]||(t[29]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Avg Event Loop",-1)),e("p",St,o(Math.round(a.value.workers.reduce((s,m)=>s+(m.avgEventLoopLagMs||0),0)/a.value.workers.length))+"ms ",1)]),e("div",Lt,[t[30]||(t[30]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Connection Pool",-1)),e("p",At,o(a.value.workers.reduce((s,m)=>s+(m.freeSlots||0),0))+"/"+o(a.value.workers.reduce((s,m)=>s+(m.dbConnections||0),0)),1)]),e("div",Pt,[t[31]||(t[31]=e("p",{class:"text-xs text-light-500 uppercase tracking-wide"},"Max Job Queue",-1)),e("p",Mt,o(Math.max(...a.value.workers.map(s=>s.jobQueueSize||0))),1)])])])])):b("",!0)],64)):b("",!0)])}}};export{Nt as default};
